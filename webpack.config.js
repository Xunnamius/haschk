/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the config/*.js version of
* ! this file to make permanent modifications!
*/

"use strict";

require("source-map-support/register");

var _package = _interopRequireDefault(require("./package"));

var _webpack = _interopRequireDefault(require("webpack"));

var _cleanWebpackPlugin = _interopRequireDefault(require("clean-webpack-plugin"));

var _copyWebpackPlugin = _interopRequireDefault(require("copy-webpack-plugin"));

var _htmlWebpackPlugin = _interopRequireDefault(require("html-webpack-plugin"));

var _writeFileWebpackPlugin = _interopRequireDefault(require("write-file-webpack-plugin"));

var _parseGitignore = _interopRequireDefault(require("parse-gitignore"));

var _fs = require("fs");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

require('dotenv').config();

const {
  HASHING_OUTPUT_LENGTH
} = process.env;
const paths = {};
paths.src = `${__dirname}/src`;
paths.build = `${__dirname}/build`;
paths.buildAssets = `${paths.build}/assets`;
paths.buildGitIgnore = `${paths.build}/.gitignore`;
paths.srcManifest = `${paths.src}/manifest.json`;
paths.components = `${paths.src}/components`;
paths.assets = `${paths.src}/assets`;
const assetExtensions = ['jpg', 'jpeg', 'png', `gif`, "eot", 'otf', 'svg', 'ttf', 'woff', 'woff2'];

const configure = NODE_ENV => {
  const DEV_ENV = NODE_ENV === 'development';
  const options = {};
  options.mode = DEV_ENV ? 'development' : 'production';
  options.entry = {
    background: `${paths.components}/background/index.js`,
    options: `${paths.components}/options/index.js`,
    popup: `${paths.components}/popup/index.js`
  };
  options.output = {
    path: paths.build,
    filename: '[name].packed.js'
  };
  options.module = {
    rules: [{
      test: /\.css$/,
      loader: 'style-loader!css-loader',
      exclude: /node_modules/
    }, {
      test: new RegExp(`\\.(${assetExtensions.join('|')})$`),
      loader: 'file-loader?name=[name].[ext]',
      exclude: /node_modules/
    }, {
      test: /\.html$/,
      loader: 'html-loader',
      exclude: /node_modules/
    }, {
      test: /\.js$/,
      loader: 'babel-loader?cacheDirectory',
      exclude: /node_modules/
    }]
  };
  options.plugins = [new _webpack.default.DefinePlugin({
    'process.env': {
      NODE_ENV: JSON.stringify(NODE_ENV),
      HASHING_OUTPUT_LENGTH: JSON.stringify(HASHING_OUTPUT_LENGTH)
    }
  }), new _copyWebpackPlugin.default([{
    from: paths.srcManifest,
    transform: content => Buffer.from(JSON.stringify({
      name: `${DEV_ENV ? "DEV-" : ''}${_package.default.name}`,
      description: _package.default.description,
      version: _package.default.version,
      'content_security_policy': `script-src 'self'${DEV_ENV ? " 'unsafe-eval'" : ''}; object-src 'self'`,
      ...JSON.parse(content.toString())
    }))
  }]), new _copyWebpackPlugin.default([{
    from: `${paths.assets}/icon/**/*.png`,
    to: `${paths.buildAssets}/icon/[1]`,
    test: /.*\/icon\/(.*)$/
  }]), new _htmlWebpackPlugin.default({
    template: `${paths.src}/popup.html`,
    filename: 'popup.html',
    chunks: ['popup']
  }), new _htmlWebpackPlugin.default({
    template: `${paths.src}/options.html`,
    filename: 'options.html',
    chunks: ['options']
  }), new _htmlWebpackPlugin.default({
    template: `${paths.src}/background.html`,
    filename: 'background.html',
    chunks: ['background']
  }), new _writeFileWebpackPlugin.default()];
  options.resolve = {};
  options.resolve.alias = {
    'universe': `${__dirname}/src/universe/`,
    'components': `${__dirname}/src/components/`
  };
  if (DEV_ENV) options.devtool = 'cheap-module-eval-source-map';

  if (NODE_ENV !== 'generator') {
    options.resolve.mainFields = ['browser', 'main'];
  }

  const exclude = (0, _parseGitignore.default)((0, _fs.readFileSync)(paths.buildGitIgnore)).filter(path => path.startsWith('!')).map(path => path.substr(1));
  options.plugins = [new _cleanWebpackPlugin.default([paths.build], {
    exclude
  }), ...options.plugins];
  return options;
};

module.exports = env => configure(env.NODE_ENV);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbmZpZy93ZWJwYWNrLmNvbmZpZy5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiY29uZmlnIiwiSEFTSElOR19PVVRQVVRfTEVOR1RIIiwicHJvY2VzcyIsImVudiIsInBhdGhzIiwic3JjIiwiX19kaXJuYW1lIiwiYnVpbGQiLCJidWlsZEFzc2V0cyIsImJ1aWxkR2l0SWdub3JlIiwic3JjTWFuaWZlc3QiLCJjb21wb25lbnRzIiwiYXNzZXRzIiwiYXNzZXRFeHRlbnNpb25zIiwiY29uZmlndXJlIiwiTk9ERV9FTlYiLCJERVZfRU5WIiwib3B0aW9ucyIsIm1vZGUiLCJlbnRyeSIsImJhY2tncm91bmQiLCJwb3B1cCIsIm91dHB1dCIsInBhdGgiLCJmaWxlbmFtZSIsIm1vZHVsZSIsInJ1bGVzIiwidGVzdCIsImxvYWRlciIsImV4Y2x1ZGUiLCJSZWdFeHAiLCJqb2luIiwicGx1Z2lucyIsIndlYnBhY2siLCJEZWZpbmVQbHVnaW4iLCJKU09OIiwic3RyaW5naWZ5IiwiQ29weVdlYnBhY2tQbHVnaW4iLCJmcm9tIiwidHJhbnNmb3JtIiwiY29udGVudCIsIkJ1ZmZlciIsIm5hbWUiLCJwa2ciLCJkZXNjcmlwdGlvbiIsInZlcnNpb24iLCJwYXJzZSIsInRvU3RyaW5nIiwidG8iLCJIdG1sV2VicGFja1BsdWdpbiIsInRlbXBsYXRlIiwiY2h1bmtzIiwiV3JpdGVGaWxlV2VicGFja1BsdWdpbiIsInJlc29sdmUiLCJhbGlhcyIsImRldnRvb2wiLCJtYWluRmllbGRzIiwiZmlsdGVyIiwic3RhcnRzV2l0aCIsIm1hcCIsInN1YnN0ciIsIkNsZWFuV2VicGFja1BsdWdpbiIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7QUFHQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBQSxPQUFPLENBQUMsUUFBRCxDQUFQLENBQWtCQyxNQUFsQjs7QUFFQSxNQUFNO0FBQUVDLEVBQUFBO0FBQUYsSUFBNEJDLE9BQU8sQ0FB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LENBQUNZLFFBQUwsQ0FBakMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBAZmxvdyAqL1xuXG4vLyBmbG93LWRpc2FibGUtbGluZVxuaW1wb3J0IHBrZyBmcm9tICcuL3BhY2thZ2UnXG5pbXBvcnQgd2VicGFjayBmcm9tICd3ZWJwYWNrJ1xuaW1wb3J0IENsZWFuV2VicGFja1BsdWdpbiBmcm9tICdjbGVhbi13ZWJwYWNrLXBsdWdpbidcbmltcG9ydCBDb3B5V2VicGFja1BsdWdpbiBmcm9tICdjb3B5LXdlYnBhY2stcGx1Z2luJ1xuaW1wb3J0IEh0bWxXZWJwYWNrUGx1Z2luIGZyb20gJ2h0bWwtd2VicGFjay1wbHVnaW4nXG5pbXBvcnQgV3JpdGVGaWxlV2VicGFja1BsdWdpbiBmcm9tICd3cml0ZS1maWxlLXdlYnBhY2stcGx1Z2luJ1xuaW1wb3J0IHBhcnNlR2l0SWdub3JlIGZyb20gJ3BhcnNlLWdpdGlnbm9yZSdcbmltcG9ydCB7IHJlYWRGaWxlU3luYyB9IGZyb20gJ2ZzJ1xuXG5yZXF1aXJlKCdkb3RlbnYnKS5jb25maWcoKTtcblxuY29uc3QgeyBIQVNISU5HX09VVFBVVF9MRU5HVEggfSA9IHByb2Nlc3MuZW52O1xuXG5jb25zdCBwYXRocyA9IHt9O1xuXG5wYXRocy5zcmMgPSBgJHtfX2Rpcm5hbWV9L3NyY2A7XG5wYXRocy5idWlsZCA9IGAke19fZGlybmFtZX0vYnVpbGRgO1xucGF0aHMuYnVpbGRBc3NldHMgPSBgJHtwYXRocy5idWlsZH0vYXNzZXRzYDtcbnBhdGhzLmJ1aWxkR2l0SWdub3JlID0gYCR7cGF0aHMuYnVpbGR9Ly5naXRpZ25vcmVgO1xucGF0aHMuc3JjTWFuaWZlc3QgPSBgJHtwYXRocy5zcmN9L21hbmlmZXN0Lmpzb25gO1xucGF0aHMuY29tcG9uZW50cyA9IGAke3BhdGhzLnNyY30vY29tcG9uZW50c2A7XG5wYXRocy5hc3NldHMgPSBgJHtwYXRocy5zcmN9L2Fzc2V0c2A7XG5jb25zdCBhc3NldEV4dGVuc2lvbnMgPSBbJ2pwZycsICdqcGVnJywgJ3BuZycsIGBnaWZgLCBcImVvdFwiLCAnb3RmJywgJ3N2ZycsICd0dGYnLCAnd29mZicsICd3b2ZmMiddO1xuXG5jb25zdCBjb25maWd1cmUgPSBOT0RFX0VOViA9PiB7XG4gICAgY29uc3QgREVWX0VOViA9IE5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnO1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7fTtcblxuICAgIG9wdGlvbnMubW9kZSA9IERFVl9FTlYgPyAnZGV2ZWxvcG1lbnQnIDogJ3Byb2R1Y3Rpb24nO1xuXG4gICAgb3B0aW9ucy5lbnRyeSA9IHtcbiAgICAgICAgYmFja2dyb3VuZDogYCR7cGF0aHMuY29tcG9uZW50c30vYmFja2dyb3VuZC9pbmRleC5qc2AsXG4gICAgICAgIG9wdGlvbnM6IGAke3BhdGhzLmNvbXBvbmVudHN9L29wdGlvbnMvaW5kZXguanNgLFxuICAgICAgICBwb3B1cDogYCR7cGF0aHMuY29tcG9uZW50c30vcG9wdXAvaW5kZXguanNgLFxuICAgIH07XG5cbiAgICBvcHRpb25zLm91dHB1dCA9IHtcbiAgICAgICAgcGF0aDogcGF0aHMuYnVpbGQsXG4gICAgICAgIGZpbGVuYW1lOiAnW25hbWVdLnBhY2tlZC5qcydcbiAgICB9O1xuXG4gICAgb3B0aW9ucy5tb2R1bGUgPSB7XG4gICAgICAgIHJ1bGVzOiBbXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGVzdDogL1xcLmNzcyQvLFxuICAgICAgICAgICAgICAgIGxvYWRlcjogJ3N0eWxlLWxvYWRlciFjc3MtbG9hZGVyJyxcbiAgICAgICAgICAgICAgICBleGNsdWRlOiAvbm9kZV9tb2R1bGVzL1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0ZXN0OiBuZXcgUmVnRXhwKGBcXFxcLigke2Fzc2V0RXh0ZW5zaW9ucy5qb2luKCd8Jyl9KSRgKSxcbiAgICAgICAgICAgICAgICBsb2FkZXI6ICdmaWxlLWxvYWRlcj9uYW1lPVtuYW1lXS5bZXh0XScsXG4gICAgICAgICAgICAgICAgZXhjbHVkZTogL25vZGVfbW9kdWxlcy9cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGVzdDogL1xcLmh0bWwkLyxcbiAgICAgICAgICAgICAgICBsb2FkZXI6ICdodG1sLWxvYWRlcicsXG4gICAgICAgICAgICAgICAgZXhjbHVkZTogL25vZGVfbW9kdWxlcy9cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgdGVzdDogL1xcLmpzJC8sXG4gICAgICAgICAgICAgICAgbG9hZGVyOiAnYmFiZWwtbG9hZGVyP2NhY2hlRGlyZWN0b3J5JyxcbiAgICAgICAgICAgICAgICBleGNsdWRlOiAvbm9kZV9tb2R1bGVzL1xuICAgICAgICAgICAgfVxuICAgICAgICBdXG4gICAgfTtcblxuICAgIG9wdGlvbnMucGx1Z2lucyA9IFtcbiAgICAgICAgLy8gPyBDbGVhbiBwYXRocy5idWlsZCAoYWRkZWQgYmVsb3cgaW5zdGVhZClcbiAgICAgICAgLy8gbmV3IENsZWFuV2VicGFja1BsdWdpbihbJ2J1aWxkJ10pLFxuXG4gICAgICAgIC8vID8gRXhwb3NlIGRlc2lyZWQgZW52aXJvbm1lbnQgdmFyaWFibGVzIGluIHRoZSBwYWNrZWQgYnVuZGxlXG4gICAgICAgIG5ldyB3ZWJwYWNrLkRlZmluZVBsdWdpbih7XG4gICAgICAgICAgICAncHJvY2Vzcy5lbnYnOiB7XG4gICAgICAgICAgICAgICAgTk9ERV9FTlY6IEpTT04uc3RyaW5naWZ5KE5PREVfRU5WKSxcbiAgICAgICAgICAgICAgICBIQVNISU5HX09VVFBVVF9MRU5HVEg6IEpTT04uc3RyaW5naWZ5KEhBU0hJTkdfT1VUUFVUX0xFTkdUSCksXG4gICAgICAgICAgICB9LFxuICAgICAgICB9KSxcblxuICAgICAgICBuZXcgQ29weVdlYnBhY2tQbHVnaW4oW3tcbiAgICAgICAgICAgIGZyb206IHBhdGhzLnNyY01hbmlmZXN0LFxuXG4gICAgICAgICAgICAvLyA/IEdlbmVyYXRlcyBvdXIgbWFuaWZlc3QgZmlsZSB1c2luZyBpbmZvIGZyb20gcGFja2FnZS5qc29uXG4gICAgICAgICAgICB0cmFuc2Zvcm06IGNvbnRlbnQgPT4gQnVmZmVyLmZyb20oSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIG5hbWU6IGAke0RFVl9FTlYgPyBcIkRFVi1cIiA6ICcnfSR7cGtnLm5hbWV9YCxcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogcGtnLmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgIHZlcnNpb246IHBrZy52ZXJzaW9uLFxuICAgICAgICAgICAgICAgICdjb250ZW50X3NlY3VyaXR5X3BvbGljeSc6IGBzY3JpcHQtc3JjICdzZWxmJyR7REVWX0VOViA/IFwiICd1bnNhZmUtZXZhbCdcIiA6ICcnfTsgb2JqZWN0LXNyYyAnc2VsZidgLFxuICAgICAgICAgICAgICAgIC4uLkpTT04ucGFyc2UoY29udGVudC50b1N0cmluZygpKVxuICAgICAgICAgICAgfSkpXG4gICAgICAgIH1dKSxcblxuICAgICAgICBuZXcgQ29weVdlYnBhY2tQbHVnaW4oW3tcbiAgICAgICAgICAgIGZyb206IGAke3BhdGhzLmFzc2V0c30vaWNvbi8qKi8qLnBuZ2AsXG4gICAgICAgICAgICB0bzogYCR7cGF0aHMuYnVpbGRBc3NldHN9L2ljb24vWzFdYCxcbiAgICAgICAgICAgIHRlc3Q6IC8uKlxcL2ljb25cXC8oLiopJC9cbiAgICAgICAgfV0pLFxuXG4gICAgICAgIG5ldyBIdG1sV2VicGFja1BsdWdpbih7XG4gICAgICAgICAgICB0ZW1wbGF0ZTogYCR7cGF0aHMuc3JjfS9wb3B1cC5odG1sYCxcbiAgICAgICAgICAgIGZpbGVuYW1lOiAncG9wdXAuaHRtbCcsXG4gICAgICAgICAgICBjaHVua3M6IFsncG9wdXAnXVxuICAgICAgICB9KSxcblxuICAgICAgICBuZXcgSHRtbFdlYnBhY2tQbHVnaW4oe1xuICAgICAgICAgICAgdGVtcGxhdGU6IGAke3BhdGhzLnNyY30vb3B0aW9ucy5odG1sYCxcbiAgICAgICAgICAgIGZpbGVuYW1lOiAnb3B0aW9ucy5odG1sJyxcbiAgICAgICAgICAgIGNodW5rczogWydvcHRpb25zJ11cbiAgICAgICAgfSksXG5cbiAgICAgICAgbmV3IEh0bWxXZWJwYWNrUGx1Z2luKHtcbiAgICAgICAgICAgIHRlbXBsYXRlOiBgJHtwYXRocy5zcmN9L2JhY2tncm91bmQuaHRtbGAsXG4gICAgICAgICAgICBmaWxlbmFtZTogJ2JhY2tncm91bmQuaHRtbCcsXG4gICAgICAgICAgICBjaHVua3M6IFsnYmFja2dyb3VuZCddXG4gICAgICAgIH0pLFxuXG4gICAgICAgIG5ldyBXcml0ZUZpbGVXZWJwYWNrUGx1Z2luKClcbiAgICBdO1xuXG4gICAgb3B0aW9ucy5yZXNvbHZlID0ge307XG5cbiAgICAvLyA/IFRoZXNlIGFyZSBhbGlhc2VzIHRoYXQgY2FuIGJlIHVzZWQgZHVyaW5nIEpTIGltcG9ydCBjYWxsc1xuICAgIC8vICEgTm90ZSB0aGF0IHlvdSBtdXN0IGFsc28gY2hhbmdlIHRoZXNlIHNhbWUgYWxpYXNlcyBpbiAuZmxvd2NvbmZpZ1xuICAgIC8vICEgTm90ZSB0aGF0IHlvdSBtdXN0IGFsc28gY2hhbmdlIHRoZXNlIHNhbWUgYWxpYXNlcyBpbiBwYWNrYWdlLmpzb24gKGplc3QpXG4gICAgb3B0aW9ucy5yZXNvbHZlLmFsaWFzID0ge1xuICAgICAgICAndW5pdmVyc2UnOiBgJHtfX2Rpcm5hbWV9L3NyYy91bml2ZXJzZS9gLFxuICAgICAgICAnY29tcG9uZW50cyc6IGAke19fZGlybmFtZX0vc3JjL2NvbXBvbmVudHMvYCxcbiAgICB9O1xuXG4gICAgLy8gPyBTZWU6IGh0dHBzOi8vd2VicGFjay5qcy5vcmcvY29uZmlndXJhdGlvbi9kZXZ0b29sXG4gICAgaWYoREVWX0VOVilcbiAgICAgICAgb3B0aW9ucy5kZXZ0b29sID0gJ2NoZWFwLW1vZHVsZS1ldmFsLXNvdXJjZS1tYXAnO1xuXG4gICAgaWYoTk9ERV9FTlYgIT09ICdnZW5lcmF0b3InKVxuICAgIHtcbiAgICAgICAgLy8gPyBTZWU6IGh0dHBzOi8vZ2l0aHViLmNvbS9pcGZzL2pzLWlwZnMtYXBpL3B1bGwvNzc3XG4gICAgICAgIG9wdGlvbnMucmVzb2x2ZS5tYWluRmllbGRzID0gWydicm93c2VyJywgJ21haW4nXTtcbiAgICB9XG5cbiAgICBjb25zdCBleGNsdWRlID0gcGFyc2VHaXRJZ25vcmUocmVhZEZpbGVTeW5jKHBhdGhzLmJ1aWxkR2l0SWdub3JlKSlcbiAgICAgICAgLmZpbHRlcihwYXRoID0+IHBhdGguc3RhcnRzV2l0aCgnIScpKVxuICAgICAgICAubWFwKHBhdGggPT4gcGF0aC5zdWJzdHIoMSkpO1xuXG4gICAgLy8gPyBUaGUgZm9sbG93aW5nIGlzIG5lY2Vzc2FyeSBzbyBDbGVhbldlYnBhY2tQbHVnaW4gZG9lc24ndCBraWxsIGJ1aWxkLy5naXRpZ25vcmVcbiAgICBvcHRpb25zLnBsdWdpbnMgPSBbXG4gICAgICAgIG5ldyBDbGVhbldlYnBhY2tQbHVnaW4oW3BhdGhzLmJ1aWxkXSwgeyBleGNsdWRlIH0pLFxuICAgICAgICAuLi5vcHRpb25zLnBsdWdpbnNcbiAgICBdO1xuXG4gICAgcmV0dXJuIG9wdGlvbnM7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IGVudiA9PiBjb25maWd1cmUoZW52Lk5PREVfRU5WKTtcbiJdfQ==