/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the config/*.js version of
* ! this file to make permanent modifications!
*/

"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.wpdevserv = exports.bundleZip = exports.build = exports.regenerate = exports.cleanBuild = exports.cleanTypes = void 0;

require("source-map-support/register");

var _fs = require("fs");

var _util = require("util");

var _gulp = _interopRequireDefault(require("gulp"));

var _gulpTap = _interopRequireDefault(require("gulp-tap"));

var _gulpZip = _interopRequireDefault(require("gulp-zip"));

var _del = _interopRequireDefault(require("del"));

var _fancyLog = _interopRequireDefault(require("fancy-log"));

var _parseGitignore = _interopRequireDefault(require("parse-gitignore"));

var _core = require("@babel/core");

var _path = require("path");

var _webpack = _interopRequireDefault(require("webpack"));

var _webpackDevServer = _interopRequireDefault(require("webpack-dev-server"));

var _webpack2 = _interopRequireDefault(require("./webpack.config"));

var _package = _interopRequireDefault(require("./package"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

require('dotenv').config();

const {
  WEBPACK_PORT,
  DEV_ENDPOINT,
  HASHING_OUTPUT_LENGTH
} = process.env;
const configured = (0, _webpack2.default)({
  NODE_ENV: process.env.NODE_ENV
});
if (typeof WEBPACK_PORT !== 'string') throw new TypeError('WEBPACK_PORT is improperly defined. Did you copy dist.env -> .env ?');
if (typeof DEV_ENDPOINT !== 'string') throw new TypeError('DEV_ENDPOINT is improperly defined. Did you copy dist.env -> .env ?');
if (typeof HASHING_OUTPUT_LENGTH !== 'string') throw new TypeError('HASHING_OUTPUT_LENGTH is improperly defined. Did you copy dist.env -> .env ?');
const DEV_PORT = parseInt(WEBPACK_PORT, 10);
const paths = {};
paths.flowTyped = 'flow-typed';
paths.flowTypedGitIgnore = `${paths.flowTyped}/.gitignore`;
paths.build = `build`;
paths.buildGitIgnore = `${paths.build}/.gitignore`;
paths.configs = 'config';
paths.packageJson = 'package.json';
paths.launchJson = '.vscode/launch.json';
paths.launchJsonDist = '.vscode/launch.dist.json';
paths.env = '.env';
paths.envDist = 'dist.env';
paths.gitProjectDir = '.git';
paths.gitIgnore = '.gitignore';
paths.packageLockJson = 'package-lock.json';
paths.regenTargets = [`${paths.configs}/*.js`];
const CLI_BANNER = `/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the config/*.js version of
* ! this file to make permanent modifications!
*/\n\n`;
const readFileAsync = (0, _util.promisify)(_fs.readFile);

const cleanTypes = async () => {
  const targets = (0, _parseGitignore.default)((await readFileAsync(paths.flowTypedGitIgnore)));
  (0, _fancyLog.default)(`Deletion targets @ ${paths.flowTyped}/: "${targets.join('" "')}"`);
  await (0, _del.default)(targets, {
    cwd: paths.flowTyped
  });
};

exports.cleanTypes = cleanTypes;
cleanTypes.description = `Resets the ${paths.flowTyped} directory to a pristine state`;

const cleanBuild = async () => {
  const targets = (0, _parseGitignore.default)((await readFileAsync(paths.buildGitIgnore)));
  (0, _fancyLog.default)(`Deletion targets @ ${paths.build}/: "${targets.join('" "')}"`);
  await (0, _del.default)(targets, {
    cwd: paths.build
  });
};

exports.cleanBuild = cleanBuild;
cleanBuild.description = `Resets the ${paths.build} directory to a pristine state`;

const regenerate = () => {
  (0, _fancyLog.default)(`Regenerating targets: "${paths.regenTargets.join('" "')}"`);
  process.env.BABEL_ENV = 'generator';
  return _gulp.default.src(paths.regenTargets).pipe((0, _gulpTap.default)(file => file.contents = Buffer.from(CLI_BANNER + (0, _core.transformSync)(file.contents.toString(), {
    sourceFileName: (0, _path.relative)(__dirname, file.path)
  }).code))).pipe(_gulp.default.dest('.'));
};

exports.regenerate = regenerate;
regenerate.description = 'Invokes babel on the files in config, transpiling them into their project root versions';

const build = () => {
  process.env.NODE_ENV = 'production';
  return new Promise(resolve => {
    (0, _webpack.default)(configured, (err, stats) => {
      if (err) {
        const details = err.details ? `\n\t${err.details}` : '';
        throw `WEBPACK FATAL BUILD ERROR: ${err}${details}`;
      }

      const info = stats.toJson();
      if (stats.hasErrors()) throw `WEBPACK COMPILATION ERROR: ${info.errors}`;
      if (stats.hasWarnings()) console.warn(`WEBPACK COMPILATION WARNING: ${info.warnings}`);
      resolve();
    });
  });
};

exports.build = build;
build.description = 'Yields a production-ready unpacked extension via the build directory';

const bundleZip = async () => {
  await (0, _del.default)([`${_package.default.name}-*.zip`]).then(() => {
    _gulp.default.src('build/**/*').pipe((0, _gulpZip.default)(`${_package.default.name}-${_package.default.version}.zip`)).pipe(_gulp.default.dest('.'));
  });
};

exports.bundleZip = bundleZip;
bundleZip.description = 'Bundles the build directory into a zip archive for upload to the Chrome Web Store and elsewhere';

const wpdevserv = () => {
  var _configured$plugins;

  Object.keys(configured.entry).forEach(entryKey => configured.entry[entryKey] = [`webpack-dev-server/client?http://${DEV_ENDPOINT}:${DEV_PORT}`, 'webpack/hot/dev-server'].concat(configured.entry[entryKey]));
  configured.plugins = [new _webpack.default.HotModuleReplacementPlugin(), ...((_configured$plugins = configured.plugins) !== null && _configured$plugins !== void 0 ? _configured$plugins : [])];
  const packer = (0, _webpack.default)(configured);
  const server = new _webpackDevServer.default(packer, {
    hot: true,
    contentBase: paths.build,
    headers: {
      'Access-Control-Allow-Origin': '*'
    }
  });
  server.listen(DEV_PORT, err => {
    if (err) throw `WEBPACK DEV SERVER ERROR: ${err}`;
  });
};

exports.wpdevserv = wpdevserv;
wpdevserv.description = 'Launches the Webpack Development Server for testing purposes';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbmZpZy9ndWxwZmlsZS5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiY29uZmlnIiwiV0VCUEFDS19QT1JUIiwiREVWX0VORFBPSU5UIiwiSEFTSElOR19PVVRQVVRfTEVOR1RIIiwicHJvY2VzcyIsImVudiIsImNvbmZpZ3VyZWQiLCJOT0RFX0VOViIsIlR5cGVFcnJvciIsIkRFVl9QT1JUIiwicGFyc2VJbnQiLCJwYXRocyIsImZsb3dUeXBlZCIsImZsb3dUeXBlZEdpdElnbm9yZSIsImJ1aWxkIiwiYnVpbGRHaXRJZ25vcmUiLCJjb25maWdzIiwicGFja2FnZUpzb24iLCJsYXVuY2hKc29uIiwibGF1bmNoSnNvbkRpc3QiLCJlbnZEaXN0IiwiZ2l0UHJvamVjdERpciIsImdpdElnbm9yZSIsInBhY2thZ2VMb2NrSnNvbiIsInJlZ2VuVGFyZ2V0cyIsIkNMSV9CQU5ORVIiLCJyZWFkRmlsZUFzeW5jIiwicmVhZEZpbGUiLCJjbGVhblR5cGVzIiwidGFyZ2V0cyIsImpvaW4iLCJjd2QiLCJkZXNjcmlwdGlvbiIsImNsZWFuQnVpbGQiLCJyZWdlbmVyYXRlIiwiQkFCRUxfRU5WIiwiZ3VscCIsInNyYyIsInBpcGUiLCJmaWxlIiwiY29udGVudHMiLCJCdWZmZXIiLCJmcm9tIiwidG9TdHJpbmciLCJzb3VyY2VGaWxlTmFtZSIsIl9fZGlybmFtZSIsInBhdGgiLCJjb2RlIiwiZGVzdCIsIlByb21pc2UiLCJyZXNvbHZlIiwiZXJyIiwic3RhdHMiLCJkZXRhaWxzIiwiaW5mbyIsInRvSnNvbiIsImhhc0Vycm9ycyIsImVycm9ycyIsImhhc1dhcm5pbmdzIiwiY29uc29sZSIsIndhcm4iLCJ3YXJuaW5ncyIsImJ1bmRsZVppcCIsInBrZyIsIm5hbWUiLCJ0aGVuIiwidmVyc2lvbiIsIndwZGV2c2VydiIsIk9iamVjdCIsImtleXMiLCJlbnRyeSIsImZvckVhY2giLCJlbnRyeUtleSIsImNvbmNhdCIsInBsdWdpbnMiLCJ3ZWJwYWNrIiwiSG90TW9kdWxlUmVwbGFjZW1lbnRQbHVnaW4iLCJwYWNrZXIiLCJzZXJ2ZXIiLCJ3ZWJwYWNrRGV2U2VydmVyIiwiaG90IiwiY29udGVudEJhc2UiLCJoZWFkZXJzIiwibGlzdGVuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFRQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFFQTs7OztBQUVBQSxPQUFPLENBQUMsUUFBRCxDQUFQLENBQWtCQyxNQUFsQjs7QUFFQSxNQUFNO0FBQ0ZDLEVBQUFBLFlBREU7QUFFRkMsRUFBQUEsWUFGRTtBQUdGQyxFQUFBQTtBQUhFLElBSUZDLE9BQU8sQ0FBQ0MsR0FKWjtBQU1BLE1BQU1DLFVBQVUsR0FBRyx1QkFBTztBQUFFQyxFQUFBQSxRQUFRLEVBQUVILE9BQU8sQ0FBQ0MsR0FBUixDQUFZRTtBQUF4QixDQUFQLENBQW5CO0FBRUEsSUFBRyxPQUFPTixZQUFQLEtBQXdCLFFBQTNCLEVBQ0ksTUFBTSxJQUFJTyxTQUFKLENBQWMscUVBQWQsQ0FBTjtBQUVKLElBQUcsT0FBT04sWUFBUCxLQUF3QixRQUEzQixFQUNJLE1BQU0sSUFBSU0sU0FBSixDQUFjLHFFQUFkLENBQU47QUFFSixJQUFHLE9BQU9MLHFCQUFQLEtBQWlDLFFBQXBDLEVBQ0ksTUFBTSxJQUFJSyxTQUFKLENBQWMsOEVBQWQsQ0FBTjtBQUVKLE1BQU1DLFFBQVEsR0FBR0MsUUFBUSxDQUFDVCxZQUFELEVBQWUsRUFBZixDQUF6QjtBQUVBLE1BQU1VLEtBQUssR0FBRyxFQUFkO0FBRUFBLEtBQUssQ0FBQ0MsU0FBTixHQUFrQixZQUFsQjtBQUNBRCxLQUFLLENBQUNFLGtCQUFOLEdBQTRCLEdBQUVGLEtBQUssQ0FBQ0MsU0FBVSxhQUE5QztBQUNBRCxLQUFLLENBQUNHLEtBQU4sR0FBZSxPQUFmO0FBQ0FILEtBQUssQ0FBQ0ksY0FBTixHQUF3QixHQUFFSixLQUFLLENBQUNHLEtBQU0sYUFBdEM7QUFDQUgsS0FBSyxDQUFDSyxPQUFOLEdBQWdCLFFBQWhCO0FBQ0FMLEtBQUssQ0FBQ00sV0FBTixHQUFvQixjQUFwQjtBQUNBTixLQUFLLENBQUNPLFVBQU4sR0FBbUIscUJBQW5CO0FBQ0FQLEtBQUssQ0FBQ1EsY0FBTixHQUF1QiwwQkFBdkI7QUFDQVIsS0FBSyxDQUFDTixHQUFOLEdBQVksTUFBWjtBQUNBTSxLQUFLLENBQUNTLE9BQU4sR0FBZ0IsVUFBaEI7QUFDQVQsS0FBSyxDQUFDVSxhQUFOLEdBQXNCLE1BQXRCO0FBQ0FWLEtBQUssQ0FBQ1csU0FBTixHQUFrQixZQUFsQjtBQUNBWCxLQUFLLENBQUNZLGVBQU4sR0FBd0IsbUJBQXhCO0FBRUFaLEtBQUssQ0FBQ2EsWUFBTixHQUFxQixDQUNoQixHQUFFYixLQUFLLENBQUNLLE9BQVEsT0FEQSxDQUFyQjtBQUlBLE1BQU1TLFVBQVUsR0FBSTs7OztPQUFwQjtBQU1BLE1BQU1DLGFBQWEsR0FBRyxxQkFBVUMsWUFBVixDQUF0Qjs7QUFJTyxNQUFNQyxVQUFVLEdBQUcsWUFBWTtBQUNsQyxRQUFNQyxPQUFPLEdBQUcsOEJBQWUsTUFBTUgsYUFBYSxDQUFDZixLQUFLLENBQUNFLGtCQUFQLENBQWxDLEVBQWhCO0FBRUEseUJBQUssc0JBQXFCRixLQUFLLENBQUNDLFNBQVUsT0FBTWlCLE9BQU8sQ0FBQ0MsSUFBUixDQUFhLEtBQWIsQ0FBb0IsR0FBcEU7QUFDQSxRQUFNLGtCQUFJRCxPQUFKLEVBQWE7QUFBRUUsSUFBQUEsR0FBRyxFQUFFcEIsS0FBSyxDQUFDQztBQUFiLEdBQWIsQ0FBTjtBQUNILENBTE07OztBQU9QZ0IsVUFBVSxDQUFDSSxXQUFYLEdBQTBCLGNBQWFyQixLQUFLLENBQUNDLFNBQVUsZ0NBQXZEOztBQUlPLE1BQU1xQixVQUFVLEdBQUcsWUFBWTtBQUNsQyxRQUFNSixPQUFPLEdBQUcsOEJBQWUsTUFBTUgsYUFBYSxDQUFDZixLQUFLLENBQUNJLGNBQVAsQ0FBbEMsRUFBaEI7QUFFQSx5QkFBSyxzQkFBcUJKLEtBQUssQ0FBQ0csS0FBTSxPQUFNZSxPQUFPLENBQUNDLElBQVIsQ0FBYSxLQUFiLENBQW9CLEdBQWhFO0FBQ0EsUUFBTSxrQkFBSUQsT0FBSixFQUFhO0FBQUVFLElBQUFBLEdBQUcsRUFBRXBCLEtBQUssQ0FBQ0c7QUFBYixHQUFiLENBQU47QUFDSCxDQUxNOzs7QUFPUG1CLFVBQVUsQ0FBQ0QsV0FBWCxHQUEwQixjQUFhckIsS0FBSyxDQUFDRyxLQUFNLGdDQUFuRDs7QUFRTyxNQUFNb0IsVUFBVSxHQUFHLE1BQU07QUFDNUIseUJBQUssMEJBQXlCdkIsS0FBSyxDQUFDYSxZQUFOLENBQW1CTSxJQUFuQixDQUF3QixLQUF4QixDQUErQixHQUE3RDtBQUVBMUIsRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVk4QixTQUFaLEdBQXdCLFdBQXhCO0FBRUEsU0FBT0MsY0FBS0MsR0FBTCxDQUFTMUIsS0FBSyxDQUFDYSxZQUFmLEVBQ0ZjLElBREUsQ0FDRyxzQkFBSUMsSUFBSSxJQUFJQSxJQUFJLENBQUNDLFFBQUwsR0FBZ0JDLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZakIsVUFBVSxHQUFHLHlCQUFNYyxJQUFJLENBQUNDLFFBQUwsQ0FBY0csUUFBZCxFQUFOLEVBQWdDO0FBQ3ZGQyxJQUFBQSxjQUFjLEVBQUUsb0JBQVFDLFNBQVIsRUFBbUJOLElBQUksQ0FBQ08sSUFBeEI7QUFEdUUsR0FBaEMsRUFFeERDLElBRitCLENBQTVCLENBREgsRUFJRlQsSUFKRSxDQUlHRixjQUFLWSxJQUFMLENBQVUsR0FBVixDQUpILENBQVA7QUFLSCxDQVZNOzs7QUFZUGQsVUFBVSxDQUFDRixXQUFYLEdBQXlCLHlGQUF6Qjs7QUFJTyxNQUFNbEIsS0FBSyxHQUFHLE1BQXFCO0FBQ3RDVixFQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWUUsUUFBWixHQUF1QixZQUF2QjtBQUNBLFNBQU8sSUFBSTBDLE9BQUosQ0FBWUMsT0FBTyxJQUFJO0FBQzFCLDBCQUFRNUMsVUFBUixFQUFvQixDQUFDNkMsR0FBRCxFQUFNQyxLQUFOLEtBQWdCO0FBQ2hDLFVBQUdELEdBQUgsRUFDQTtBQUNJLGNBQU1FLE9BQU8sR0FBR0YsR0FBRyxDQUFDRSxPQUFKLEdBQWUsT0FBTUYsR0FBRyxDQUFDRSxPQUFRLEVBQWpDLEdBQXFDLEVBQXJEO0FBQ0EsY0FBTyw4QkFBNkJGLEdBQUksR0FBRUUsT0FBUSxFQUFsRDtBQUNIOztBQUVELFlBQU1DLElBQUksR0FBR0YsS0FBSyxDQUFDRyxNQUFOLEVBQWI7QUFFQSxVQUFHSCxLQUFLLENBQUNJLFNBQU4sRUFBSCxFQUNJLE1BQU8sOEJBQTZCRixJQUFJLENBQUNHLE1BQU8sRUFBaEQ7QUFFSixVQUFHTCxLQUFLLENBQUNNLFdBQU4sRUFBSCxFQUNJQyxPQUFPLENBQUNDLElBQVIsQ0FBYyxnQ0FBK0JOLElBQUksQ0FBQ08sUUFBUyxFQUEzRDtBQUVKWCxNQUFBQSxPQUFPO0FBQ1YsS0FoQkQ7QUFpQkgsR0FsQk0sQ0FBUDtBQW1CSCxDQXJCTTs7O0FBdUJQcEMsS0FBSyxDQUFDa0IsV0FBTixHQUFvQixzRUFBcEI7O0FBSU8sTUFBTThCLFNBQVMsR0FBRyxZQUFZO0FBQ2pDLFFBQU0sa0JBQUksQ0FBRSxHQUFFQyxpQkFBSUMsSUFBSyxRQUFiLENBQUosRUFBMkJDLElBQTNCLENBQWdDLE1BQU07QUFDeEM3QixrQkFBS0MsR0FBTCxDQUFTLFlBQVQsRUFBdUJDLElBQXZCLENBQTRCLHNCQUFLLEdBQUV5QixpQkFBSUMsSUFBSyxJQUFHRCxpQkFBSUcsT0FBUSxNQUEvQixDQUE1QixFQUFtRTVCLElBQW5FLENBQXdFRixjQUFLWSxJQUFMLENBQVUsR0FBVixDQUF4RTtBQUNILEdBRkssQ0FBTjtBQUdILENBSk07OztBQU1QYyxTQUFTLENBQUM5QixXQUFWLEdBQXdCLGlHQUF4Qjs7QUFJTyxNQUFNbUMsU0FBUyxHQUFHLE1BQU07QUFBQTs7QUFDM0JDLEVBQUFBLE1BQU0sQ0FBQ0MsSUFBUCxDQUFZL0QsVUFBVSxDQUFDZ0UsS0FBdkIsRUFBOEJDLE9BQTlCLENBQXNDQyxRQUFRLElBQUlsRSxVQUFVLENBQUNnRSxLQUFYLENBQWlCRSxRQUFqQixJQUE2QixDQUMxRSxvQ0FBbUN0RSxZQUFhLElBQUdPLFFBQVMsRUFEYyxFQUUzRSx3QkFGMkUsRUFHN0VnRSxNQUg2RSxDQUd0RW5FLFVBQVUsQ0FBQ2dFLEtBQVgsQ0FBaUJFLFFBQWpCLENBSHNFLENBQS9FO0FBS0FsRSxFQUFBQSxVQUFVLENBQUNvRSxPQUFYLEdBQXNCLENBQ2xCLElBQUlDLGlCQUFRQywwQkFBWixFQURrQixFQUVsQiwyQkFBSXRFLFVBQVUsQ0FBQ29FLE9BQWYscUVBQTBCLEVBQTFCLENBRmtCLENBQXRCO0FBS0EsUUFBTUcsTUFBTSxHQUFHLHNCQUFRdkUsVUFBUixDQUFmO0FBQ0EsUUFBTXdFLE1BQU0sR0FBRyxJQUFJQyx5QkFBSixDQUFxQkYsTUFBckIsRUFBNkI7QUFDeENHLElBQUFBLEdBQUcsRUFBRSxJQURtQztBQUV4Q0MsSUFBQUEsV0FBVyxFQUFFdEUsS0FBSyxDQUFDRyxLQUZxQjtBQUd4Q29FLElBQUFBLE9BQU8sRUFBRTtBQUFFLHFDQUErQjtBQUFqQztBQUgrQixHQUE3QixDQUFmO0FBTUFKLEVBQUFBLE1BQU0sQ0FBQ0ssTUFBUCxDQUFjMUUsUUFBZCxFQUF3QjBDLEdBQUcsSUFBSTtBQUFFLFFBQUdBLEdBQUgsRUFBUSxNQUFPLDZCQUE0QkEsR0FBSSxFQUF2QztBQUEwQyxHQUFuRjtBQUNILENBbkJNOzs7QUFxQlBnQixTQUFTLENBQUNuQyxXQUFWLEdBQXdCLDhEQUF4QiIsInNvdXJjZXNDb250ZW50IjpbIi8qIEBmbG93ICovXG5cbi8vID8gVG8gcmVnZW5lcmF0ZSB0aGlzIGZpbGUgKGkuZS4gaWYgeW91IGNoYW5nZWQgaXQgYW5kIHdhbnQgeW91ciBjaGFuZ2VzIHRvXG4vLyA/IGJlIHZpc2libGUpLCBjYWxsIGBucG0gcnVuIHJlZ2VuZXJhdGVgIGFmdGVyd2FyZHNcblxuLy8gVE9ETzogbWFrZSBhIGZvcmsgb2YgbnBtLWJ1bXAgdGhhdCBkb2Vzbid0IHN1Y2sgYW5kIHRoZW4gdXNlIGl0IGluIGxpZXUgb2Zcbi8vIFRPRE86IGl0cyBwcmVkZWNlc3NvciBiZWxvdy5cblxuaW1wb3J0IHsgcmVhZEZpbGUgfSBmcm9tICdmcydcbmltcG9ydCB7IHByb21pc2lmeSB9IGZyb20gJ3V0aWwnXG5pbXBvcnQgZ3VscCBmcm9tICdndWxwJ1xuaW1wb3J0IHRhcCBmcm9tICdndWxwLXRhcCdcbmltcG9ydCB6aXAgZnJvbSAnZ3VscC16aXAnXG5pbXBvcnQgZGVsIGZyb20gJ2RlbCdcbmltcG9ydCBsb2cgZnJvbSAnZmFuY3ktbG9nJ1xuaW1wb3J0IHBhcnNlR2l0SWdub3JlIGZyb20gJ3BhcnNlLWdpdGlnbm9yZSdcbmltcG9ydCB7IHRyYW5zZm9ybVN5bmMgYXMgYmFiZWwgfSBmcm9tICdAYmFiZWwvY29yZSdcbmltcG9ydCB7IHJlbGF0aXZlIGFzIHJlbFBhdGggfSBmcm9tICdwYXRoJ1xuaW1wb3J0IHdlYnBhY2sgZnJvbSAnd2VicGFjaydcbmltcG9ydCB3ZWJwYWNrRGV2U2VydmVyIGZyb20gJ3dlYnBhY2stZGV2LXNlcnZlcidcbi8vIGZsb3ctZGlzYWJsZS1saW5lXG5pbXBvcnQgY29uZmlnIGZyb20gJy4vd2VicGFjay5jb25maWcnXG4vLyBmbG93LWRpc2FibGUtbGluZVxuaW1wb3J0IHBrZyBmcm9tICcuL3BhY2thZ2UnXG5cbnJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZygpO1xuXG5jb25zdCB7XG4gICAgV0VCUEFDS19QT1JULFxuICAgIERFVl9FTkRQT0lOVCxcbiAgICBIQVNISU5HX09VVFBVVF9MRU5HVEhcbn0gPSBwcm9jZXNzLmVudjtcblxuY29uc3QgY29uZmlndXJlZCA9IGNvbmZpZyh7IE5PREVfRU5WOiBwcm9jZXNzLmVudi5OT0RFX0VOViB9KTtcblxuaWYodHlwZW9mIFdFQlBBQ0tfUE9SVCAhPT0gJ3N0cmluZycpXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignV0VCUEFDS19QT1JUIGlzIGltcHJvcGVybHkgZGVmaW5lZC4gRGlkIHlvdSBjb3B5IGRpc3QuZW52IC0+IC5lbnYgPycpO1xuXG5pZih0eXBlb2YgREVWX0VORFBPSU5UICE9PSAnc3RyaW5nJylcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdERVZfRU5EUE9JTlQgaXMgaW1wcm9wZXJseSBkZWZpbmVkLiBEaWQgeW91IGNvcHkgZGlzdC5lbnYgLT4gLmVudiA/Jyk7XG5cbmlmKHR5cGVvZiBIQVNISU5HX09VVFBVVF9MRU5HVEggIT09ICdzdHJpbmcnKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0hBU0hJTkdfT1VUUFVUX0xFTkdUSCBpcyBpbXByb3Blcmx5IGRlZmluZWQuIERpZCB5b3UgY29weSBkaXN0LmVudiAtPiAuZW52ID8nKTtcblxuY29uc3QgREVWX1BPUlQgPSBwYXJzZUludChXRUJQQUNLX1BPUlQsIDEwKTtcblxuY29uc3QgcGF0aHMgPSB7fTtcblxucGF0aHMuZmxvd1R5cGVkID0gJ2Zsb3ctdHlwZWQnO1xucGF0aHMuZmxvd1R5cGVkR2l0SWdub3JlID0gYCR7cGF0aHMuZmxvd1R5cGVkfS8uZ2l0aWdub3JlYDtcbnBhdGhzLmJ1aWxkID0gYGJ1aWxkYDtcbnBhdGhzLmJ1aWxkR2l0SWdub3JlID0gYCR7cGF0aHMuYnVpbGR9Ly5naXRpZ25vcmVgO1xucGF0aHMuY29uZmlncyA9ICdjb25maWcnO1xucGF0aHMucGFja2FnZUpzb24gPSAncGFja2FnZS5qc29uJztcbnBhdGhzLmxhdW5jaEpzb24gPSAnLnZzY29kZS9sYXVuY2guanNvbic7XG5wYXRocy5sYXVuY2hKc29uRGlzdCA9ICcudnNjb2RlL2xhdW5jaC5kaXN0Lmpzb24nO1xucGF0aHMuZW52ID0gJy5lbnYnO1xucGF0aHMuZW52RGlzdCA9ICdkaXN0LmVudic7XG5wYXRocy5naXRQcm9qZWN0RGlyID0gJy5naXQnO1xucGF0aHMuZ2l0SWdub3JlID0gJy5naXRpZ25vcmUnO1xucGF0aHMucGFja2FnZUxvY2tKc29uID0gJ3BhY2thZ2UtbG9jay5qc29uJztcblxucGF0aHMucmVnZW5UYXJnZXRzID0gW1xuICAgIGAke3BhdGhzLmNvbmZpZ3N9LyouanNgXG5dO1xuXG5jb25zdCBDTElfQkFOTkVSID0gYC8qKlxuKiAhISEgRE8gTk9UIEVESVQgVEhJUyBGSUxFIERJUkVDVExZICEhIVxuKiAhIFRoaXMgZmlsZSBoYXMgYmVlbiBnZW5lcmF0ZWQgYXV0b21hdGljYWxseS4gU2VlIHRoZSBjb25maWcvKi5qcyB2ZXJzaW9uIG9mXG4qICEgdGhpcyBmaWxlIHRvIG1ha2UgcGVybWFuZW50IG1vZGlmaWNhdGlvbnMhXG4qL1xcblxcbmA7XG5cbmNvbnN0IHJlYWRGaWxlQXN5bmMgPSBwcm9taXNpZnkocmVhZEZpbGUpO1xuXG4vLyAqIENMRUFOVFlQRVNcblxuZXhwb3J0IGNvbnN0IGNsZWFuVHlwZXMgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0cyA9IHBhcnNlR2l0SWdub3JlKGF3YWl0IHJlYWRGaWxlQXN5bmMocGF0aHMuZmxvd1R5cGVkR2l0SWdub3JlKSk7XG5cbiAgICBsb2coYERlbGV0aW9uIHRhcmdldHMgQCAke3BhdGhzLmZsb3dUeXBlZH0vOiBcIiR7dGFyZ2V0cy5qb2luKCdcIiBcIicpfVwiYCk7XG4gICAgYXdhaXQgZGVsKHRhcmdldHMsIHsgY3dkOiBwYXRocy5mbG93VHlwZWQgfSk7XG59O1xuXG5jbGVhblR5cGVzLmRlc2NyaXB0aW9uID0gYFJlc2V0cyB0aGUgJHtwYXRocy5mbG93VHlwZWR9IGRpcmVjdG9yeSB0byBhIHByaXN0aW5lIHN0YXRlYDtcblxuLy8gKiBDTEVBTkJVSUxEXG5cbmV4cG9ydCBjb25zdCBjbGVhbkJ1aWxkID0gYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHRhcmdldHMgPSBwYXJzZUdpdElnbm9yZShhd2FpdCByZWFkRmlsZUFzeW5jKHBhdGhzLmJ1aWxkR2l0SWdub3JlKSk7XG5cbiAgICBsb2coYERlbGV0aW9uIHRhcmdldHMgQCAke3BhdGhzLmJ1aWxkfS86IFwiJHt0YXJnZXRzLmpvaW4oJ1wiIFwiJyl9XCJgKTtcbiAgICBhd2FpdCBkZWwodGFyZ2V0cywgeyBjd2Q6IHBhdGhzLmJ1aWxkIH0pO1xufTtcblxuY2xlYW5CdWlsZC5kZXNjcmlwdGlvbiA9IGBSZXNldHMgdGhlICR7cGF0aHMuYnVpbGR9IGRpcmVjdG9yeSB0byBhIHByaXN0aW5lIHN0YXRlYDtcblxuLy8gKiBSRUdFTkVSQVRFXG5cbi8vID8gSWYgeW91IGNoYW5nZSB0aGlzIGZ1bmN0aW9uLCBydW4gYG5wbSBydW4gcmVnZW5lcmF0ZWAgdHdpY2U6IG9uY2UgdG9cbi8vID8gY29tcGlsZSB0aGlzIG5ldyBmdW5jdGlvbiBhbmQgb25jZSBhZ2FpbiB0byBjb21waWxlIGl0c2VsZiB3aXRoIHRoZSBuZXdseVxuLy8gPyBjb21waWxlZCBsb2dpYy4gSWYgdGhlcmUgaXMgYW4gZXJyb3IgdGhhdCBwcmV2ZW50cyByZWdlbmVyYXRpb24sIHlvdSBjYW5cbi8vID8gcnVuIGBucG0gcnVuIGdlbmVyYXRlYCB0aGVuIGBucG0gcnVuIHJlZ2VuZXJhdGVgIGluc3RlYWQuXG5leHBvcnQgY29uc3QgcmVnZW5lcmF0ZSA9ICgpID0+IHtcbiAgICBsb2coYFJlZ2VuZXJhdGluZyB0YXJnZXRzOiBcIiR7cGF0aHMucmVnZW5UYXJnZXRzLmpvaW4oJ1wiIFwiJyl9XCJgKTtcblxuICAgIHByb2Nlc3MuZW52LkJBQkVMX0VOViA9ICdnZW5lcmF0b3InO1xuXG4gICAgcmV0dXJuIGd1bHAuc3JjKHBhdGhzLnJlZ2VuVGFyZ2V0cylcbiAgICAgICAgLnBpcGUodGFwKGZpbGUgPT4gZmlsZS5jb250ZW50cyA9IEJ1ZmZlci5mcm9tKENMSV9CQU5ORVIgKyBiYWJlbChmaWxlLmNvbnRlbnRzLnRvU3RyaW5nKCksIHtcbiAgICAgICAgICAgIHNvdXJjZUZpbGVOYW1lOiByZWxQYXRoKF9fZGlybmFtZSwgZmlsZS5wYXRoKVxuICAgICAgICB9KS5jb2RlKSkpXG4gICAgICAgIC5waXBlKGd1bHAuZGVzdCgnLicpKTtcbn07XG5cbnJlZ2VuZXJhdGUuZGVzY3JpcHRpb24gPSAnSW52b2tlcyBiYWJlbCBvbiB0aGUgZmlsZXMgaW4gY29uZmlnLCB0cmFuc3BpbGluZyB0aGVtIGludG8gdGhlaXIgcHJvamVjdCByb290IHZlcnNpb25zJztcblxuLy8gKiBCVUlMRCAocHJvZHVjdGlvbilcblxuZXhwb3J0IGNvbnN0IGJ1aWxkID0gKCk6IFByb21pc2U8dm9pZD4gPT4ge1xuICAgIHByb2Nlc3MuZW52Lk5PREVfRU5WID0gJ3Byb2R1Y3Rpb24nO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHtcbiAgICAgICAgd2VicGFjayhjb25maWd1cmVkLCAoZXJyLCBzdGF0cykgPT4ge1xuICAgICAgICAgICAgaWYoZXJyKVxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGNvbnN0IGRldGFpbHMgPSBlcnIuZGV0YWlscyA/IGBcXG5cXHQke2Vyci5kZXRhaWxzfWAgOiAnJztcbiAgICAgICAgICAgICAgICB0aHJvdyBgV0VCUEFDSyBGQVRBTCBCVUlMRCBFUlJPUjogJHtlcnJ9JHtkZXRhaWxzfWA7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGNvbnN0IGluZm8gPSBzdGF0cy50b0pzb24oKTtcblxuICAgICAgICAgICAgaWYoc3RhdHMuaGFzRXJyb3JzKCkpXG4gICAgICAgICAgICAgICAgdGhyb3cgYFdFQlBBQ0sgQ09NUElMQVRJT04gRVJST1I6ICR7aW5mby5lcnJvcnN9YDtcblxuICAgICAgICAgICAgaWYoc3RhdHMuaGFzV2FybmluZ3MoKSlcbiAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFdFQlBBQ0sgQ09NUElMQVRJT04gV0FSTklORzogJHtpbmZvLndhcm5pbmdzfWApO1xuXG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufTtcblxuYnVpbGQuZGVzY3JpcHRpb24gPSAnWWllbGRzIGEgcHJvZHVjdGlvbi1yZWFkeSB1bnBhY2tlZCBleHRlbnNpb24gdmlhIHRoZSBidWlsZCBkaXJlY3RvcnknO1xuXG4vLyAqIEJVTkRMRS1aSVBcblxuZXhwb3J0IGNvbnN0IGJ1bmRsZVppcCA9IGFzeW5jICgpID0+IHtcbiAgICBhd2FpdCBkZWwoW2Ake3BrZy5uYW1lfS0qLnppcGBdKS50aGVuKCgpID0+IHtcbiAgICAgICAgZ3VscC5zcmMoJ2J1aWxkLyoqLyonKS5waXBlKHppcChgJHtwa2cubmFtZX0tJHtwa2cudmVyc2lvbn0uemlwYCkpLnBpcGUoZ3VscC5kZXN0KCcuJykpO1xuICAgIH0pO1xufTtcblxuYnVuZGxlWmlwLmRlc2NyaXB0aW9uID0gJ0J1bmRsZXMgdGhlIGJ1aWxkIGRpcmVjdG9yeSBpbnRvIGEgemlwIGFyY2hpdmUgZm9yIHVwbG9hZCB0byB0aGUgQ2hyb21lIFdlYiBTdG9yZSBhbmQgZWxzZXdoZXJlJztcblxuLy8gKiBXUERFVlNFUlZcblxuZXhwb3J0IGNvbnN0IHdwZGV2c2VydiA9ICgpID0+IHtcbiAgICBPYmplY3Qua2V5cyhjb25maWd1cmVkLmVudHJ5KS5mb3JFYWNoKGVudHJ5S2V5ID0+IGNvbmZpZ3VyZWQuZW50cnlbZW50cnlLZXldID0gW1xuICAgICAgICBgd2VicGFjay1kZXYtc2VydmVyL2NsaWVudD9odHRwOi8vJHtERVZfRU5EUE9JTlR9OiR7REVWX1BPUlR9YCxcbiAgICAgICAgJ3dlYnBhY2svaG90L2Rldi1zZXJ2ZXInXG4gICAgXS5jb25jYXQoY29uZmlndXJlZC5lbnRyeVtlbnRyeUtleV0pKTtcblxuICAgIGNvbmZpZ3VyZWQucGx1Z2lucyA9IChbXG4gICAgICAgIG5ldyB3ZWJwYWNrLkhvdE1vZHVsZVJlcGxhY2VtZW50UGx1Z2luKCksXG4gICAgICAgIC4uLihjb25maWd1cmVkLnBsdWdpbnMgPz8gW10pLFxuICAgIF06IEFycmF5PGFueT4pO1xuXG4gICAgY29uc3QgcGFja2VyID0gd2VicGFjayhjb25maWd1cmVkKTtcbiAgICBjb25zdCBzZXJ2ZXIgPSBuZXcgd2VicGFja0RldlNlcnZlcihwYWNrZXIsIHtcbiAgICAgICAgaG90OiB0cnVlLFxuICAgICAgICBjb250ZW50QmFzZTogcGF0aHMuYnVpbGQsXG4gICAgICAgIGhlYWRlcnM6IHsgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJyB9XG4gICAgfSk7XG5cbiAgICBzZXJ2ZXIubGlzdGVuKERFVl9QT1JULCBlcnIgPT4geyBpZihlcnIpIHRocm93IGBXRUJQQUNLIERFViBTRVJWRVIgRVJST1I6ICR7ZXJyfWAgfSk7XG59O1xuXG53cGRldnNlcnYuZGVzY3JpcHRpb24gPSAnTGF1bmNoZXMgdGhlIFdlYnBhY2sgRGV2ZWxvcG1lbnQgU2VydmVyIGZvciB0ZXN0aW5nIHB1cnBvc2VzJztcbiJdfQ==