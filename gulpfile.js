/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the config/*.js version of
* ! this file to make permanent modifications!
*/

"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.wpdevserv = exports.bundleZip = exports.build = exports.regenerate = exports.cleanBuild = exports.cleanTypes = void 0;

require("source-map-support/register");

var _fs = require("fs");

var _util = require("util");

var _gulp = _interopRequireDefault(require("gulp"));

var _gulpTap = _interopRequireDefault(require("gulp-tap"));

var _gulpZip = _interopRequireDefault(require("gulp-zip"));

var _del = _interopRequireDefault(require("del"));

var _fancyLog = _interopRequireDefault(require("fancy-log"));

var _parseGitignore = _interopRequireDefault(require("parse-gitignore"));

var _core = require("@babel/core");

var _path = require("path");

var _webpack = _interopRequireDefault(require("webpack"));

var _webpackDevServer = _interopRequireDefault(require("webpack-dev-server"));

var _webpack2 = _interopRequireDefault(require("./webpack.config"));

var _package = _interopRequireDefault(require("./package"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

require('dotenv').config();

const {
  WEBPACK_PORT,
  DEV_ENDPOINT,
  HASHING_OUTPUT_LENGTH
} = process.env;
const configured = (0, _webpack2.default)({
  NODE_ENV: process.env.NODE_ENV
});
if (typeof WEBPACK_PORT !== 'string') throw new TypeError('WEBPACK_PORT is improperly defined. Did you copy dist.env -> .env ?');
if (typeof DEV_ENDPOINT !== 'string') throw new TypeError('DEV_ENDPOINT is improperly defined. Did you copy dist.env -> .env ?');
if (typeof HASHING_OUTPUT_LENGTH !== 'string') throw new TypeError('HASHING_OUTPUT_LENGTH is improperly defined. Did you copy dist.env -> .env ?');
const DEV_PORT = parseInt(WEBPACK_PORT, 10);
const paths = {};
paths.flowTyped = 'flow-typed';
paths.flowTypedGitIgnore = `${paths.flowTyped}/.gitignore`;
paths.build = `build`;
paths.buildGitIgnore = `${paths.build}/.gitignore`;
paths.configs = 'config';
paths.packageJson = 'package.json';
paths.launchJson = '.vscode/launch.json';
paths.launchJsonDist = '.vscode/launch.dist.json';
paths.env = '.env';
paths.envDist = 'dist.env';
paths.gitProjectDir = '.git';
paths.gitIgnore = '.gitignore';
paths.packageLockJson = 'package-lock.json';
paths.regenTargets = [`${paths.configs}/*.js`];
const CLI_BANNER = `/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the config/*.js version of
* ! this file to make permanent modifications!
*/\n\n`;
const readFileAsync = (0, _util.promisify)(_fs.readFile);

const cleanTypes = async () => {
  const targets = (0, _parseGitignore.default)((await readFileAsync(paths.flowTypedGitIgnore)));
  (0, _fancyLog.default)(`Deletion targets @ ${paths.flowTyped}/: "${targets.join('" "')}"`);
  (0, _del.default)(targets, {
    cwd: paths.flowTyped
  });
};

exports.cleanTypes = cleanTypes;
cleanTypes.description = `Resets the ${paths.flowTyped} directory to a pristine state`;

const cleanBuild = async () => {
  const targets = (0, _parseGitignore.default)((await readFileAsync(paths.buildGitIgnore)));
  (0, _fancyLog.default)(`Deletion targets @ ${paths.build}/: "${targets.join('" "')}"`);
  (0, _del.default)(targets, {
    cwd: paths.build
  });
};

exports.cleanBuild = cleanBuild;
cleanBuild.description = `Resets the ${paths.build} directory to a pristine state`;

const regenerate = () => {
  (0, _fancyLog.default)(`Regenerating targets: "${paths.regenTargets.join('" "')}"`);
  process.env.BABEL_ENV = 'generator';
  return _gulp.default.src(paths.regenTargets).pipe((0, _gulpTap.default)(file => file.contents = Buffer.from(CLI_BANNER + (0, _core.transformSync)(file.contents.toString(), {
    sourceFileName: (0, _path.relative)(__dirname, file.path)
  }).code))).pipe(_gulp.default.dest('.'));
};

exports.regenerate = regenerate;
regenerate.description = 'Invokes babel on the files in config, transpiling them into their project root versions';

const build = () => {
  process.env.NODE_ENV = 'production';
  return new Promise(resolve => {
    (0, _webpack.default)(configured, (err, stats) => {
      if (err) {
        const details = err.details ? `\n\t${err.details}` : '';
        throw `WEBPACK FATAL BUILD ERROR: ${err}${details}`;
      }

      const info = stats.toJson();
      if (stats.hasErrors()) throw `WEBPACK COMPILATION ERROR: ${info.errors}`;
      if (stats.hasWarnings()) console.warn(`WEBPACK COMPILATION WARNING: ${info.warnings}`);
      resolve();
    });
  });
};

exports.build = build;
build.description = 'Yields a production-ready unpacked extension via the build directory';

const bundleZip = () => {
  return _gulp.default.src('build/*').pipe((0, _gulpZip.default)(`dnschk-${_package.default.version}.zip`)).pipe(_gulp.default.dest('.'));
};

exports.bundleZip = bundleZip;
bundleZip.description = 'Bundles the build directory into a zip archive for upload to the Chrome Web Store and elsewhere';

const wpdevserv = () => {
  var _configured$plugins;

  Object.keys(configured.entry).forEach(entryKey => configured.entry[entryKey] = [`webpack-dev-server/client?http://${DEV_ENDPOINT}:${DEV_PORT}`, 'webpack/hot/dev-server', configured.entry[entryKey]]);
  configured.plugins = [new _webpack.default.HotModuleReplacementPlugin(), ...((_configured$plugins = configured.plugins) !== null && _configured$plugins !== void 0 ? _configured$plugins : [])];
  const packer = (0, _webpack.default)(configured);
  const server = new _webpackDevServer.default(packer, {
    hot: true,
    contentBase: paths.build,
    headers: {
      'Access-Control-Allow-Origin': '*'
    }
  });
  server.listen(DEV_PORT, err => {
    if (err) throw `WEBPACK DEV SERVER ERROR: ${err}`;
  });
};

exports.wpdevserv = wpdevserv;
wpdevserv.description = 'Launches the Webpack Development Server for testing purposes';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbmZpZy9ndWxwZmlsZS5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiY29uZmlnIiwiV0VCUEFDS19QT1JUIiwiREVWX0VORFBPSU5UIiwiSEFTSElOR19PVVRQVVRfTEVOR1RIIiwicHJvY2VzcyIsImVudiIsImNvbmZpZ3VyZWQiLCJOT0RFX0VOViIsIlR5cGVFcnJvciIsIkRFVl9QT1JUIiwicGFyc2VJbnQiLCJwYXRocyIsImZsb3dUeXBlZCIsImZsb3dUeXBlZEdpdElnbm9yZSIsImJ1aWxkIiwiYnVpbGRHaXRJZ25vcmUiLCJjb25maWdzIiwicGFja2FnZUpzb24iLCJsYXVuY2hKc29uIiwibGF1bmNoSnNvbkRpc3QiLCJlbnZEaXN0IiwiZ2l0UHJvamVjdERpciIsImdpdElnbm9yZSIsInBhY2thZ2VMb2NrSnNvbiIsInJlZ2VuVGFyZ2V0cyIsIkNMSV9CQU5ORVIiLCJyZWFkRmlsZUFzeW5jIiwicmVhZEZpbGUiLCJjbGVhblR5cGVzIiwidGFyZ2V0cyIsImpvaW4iLCJjd2QiLCJkZXNjcmlwdGlvbiIsImNsZWFuQnVpbGQiLCJyZWdlbmVyYXRlIiwiQkFCRUxfRU5WIiwiZ3VscCIsInNyYyIsInBpcGUiLCJmaWxlIiwiY29udGVudHMiLCJCdWZmZXIiLCJmcm9tIiwidG9TdHJpbmciLCJzb3VyY2VGaWxlTmFtZSIsIl9fZGlybmFtZSIsInBhdGgiLCJjb2RlIiwiZGVzdCIsIlByb21pc2UiLCJyZXNvbHZlIiwiZXJyIiwic3RhdHMiLCJkZXRhaWxzIiwiaW5mbyIsInRvSnNvbiIsImhhc0Vycm9ycyIsImVycm9ycyIsImhhc1dhcm5pbmdzIiwiY29uc29sZSIsIndhcm4iLCJ3YXJuaW5ncyIsImJ1bmRsZVppcCIsInBrZyIsInZlcnNpb24iLCJ3cGRldnNlcnYiLCJPYmplY3QiLCJrZXlzIiwiZW50cnkiLCJmb3JFYWNoIiwiZW50cnlLZXkiLCJwbHVnaW5zIiwid2VicGFjayIsIkhvdE1vZHVsZVJlcGxhY2VtZW50UGx1Z2luIiwicGFja2VyIiwic2VydmVyIiwid2VicGFja0RldlNlcnZlciIsImhvdCIsImNvbnRlbnRCYXNlIiwiaGVhZGVycyIsImxpc3RlbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBWUE7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7O0FBQ0E7Ozs7QUFFQUEsT0FBTyxDQUFDLFFBQUQsQ0FBUCxDQUFrQkMsTUFBbEI7O0FBRUEsTUFBTTtBQUNGQyxFQUFBQSxZQURFO0FBRUZDLEVBQUFBLFlBRkU7QUFHRkMsRUFBQUE7QUFIRSxJQUlGQyxPQUFPLENBQUNDLEdBSlo7QUFNQSxNQUFNQyxVQUFVLEdBQUcsdUJBQU87QUFBRUMsRUFBQUEsUUFBUSxFQUFFSCxPQUFPLENBQUNDLEdBQVIsQ0FBWUU7QUFBeEIsQ0FBUCxDQUFuQjtBQUVBLElBQUcsT0FBT04sWUFBUCxLQUF3QixRQUEzQixFQUNJLE1BQU0sSUFBSU8sU0FBSixDQUFjLHFFQUFkLENBQU47QUFFSixJQUFHLE9BQU9OLFlBQVAsS0FBd0IsUUFBM0IsRUFDSSxNQUFNLElBQUlNLFNBQUosQ0FBYyxxRUFBZCxDQUFOO0FBRUosSUFBRyxPQUFPTCxxQkFBUCxLQUFpQyxRQUFwQyxFQUNJLE1BQU0sSUFBSUssU0FBSixDQUFjLDhFQUFkLENBQU47QUFFSixNQUFNQyxRQUFRLEdBQUdDLFFBQVEsQ0FBQ1QsWUFBRCxFQUFlLEVBQWYsQ0FBekI7QUFFQSxNQUFNVSxLQUFLLEdBQUcsRUFBZDtBQUVBQSxLQUFLLENBQUNDLFNBQU4sR0FBa0IsWUFBbEI7QUFDQUQsS0FBSyxDQUFDRSxrQkFBTixHQUE0QixHQUFFRixLQUFLLENBQUNDLFNBQVUsYUFBOUM7QUFDQUQsS0FBSyxDQUFDRyxLQUFOLEdBQWUsT0FBZjtBQUNBSCxLQUFLLENBQUNJLGNBQU4sR0FBd0IsR0FBRUosS0FBSyxDQUFDRyxLQUFNLGFBQXRDO0FBQ0FILEtBQUssQ0FBQ0ssT0FBTixHQUFnQixRQUFoQjtBQUNBTCxL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Q2pCLElBQUlDLGlCQUFRQywwQkFBWixFQURpQixFQUVqQiwyQkFBSW5FLFVBQVUsQ0FBQ2lFLE9BQWYscUVBQTBCLEVBQTFCLENBRmlCLENBQXJCO0FBS0EsUUFBTUcsTUFBTSxHQUFHLHNCQUFRcEUsVUFBUixDQUFmO0FBQ0EsUUFBTXFFLE1BQU0sR0FBRyxJQUFJQyx5QkFBSixDQUFxQkYsTUFBckIsRUFBNkI7QUFDeENHLElBQUFBLEdBQUcsRUFBRSxJQURtQztBQUV4Q0MsSUFBQUEsV0FBVyxFQUFFbkUsS0FBSyxDQUFDRyxLQUZxQjtBQUd4Q2lFLElBQUFBLE9BQU8sRUFBRTtBQUFFLHFDQUErQjtBQUFqQztBQUgrQixHQUE3QixDQUFmO0FBTUFKLEVBQUFBLE1BQU0sQ0FBQ0ssTUFBUCxDQUFjdkUsUUFBZCxFQUF3QjBDLEdBQUcsSUFBSTtBQUFFLFFBQUdBLEdBQUgsRUFBUSxNQUFPLDZCQUE0QkEsR0FBSSxFQUF2QztBQUEwQyxHQUFuRjtBQUNILENBcEJNOzs7QUFzQlBjLFNBQVMsQ0FBQ2pDLFdBQVYsR0FBd0IsOERBQXhCIiwic291cmNlc0NvbnRlbnQiOlsiLyogQGZsb3cgKi9cblxuLy8gPyBUbyByZWdlbmVyYXRlIHRoaXMgZmlsZSAoaS5lLiBpZiB5b3UgY2hhbmdlZCBpdCBhbmQgd2FudCB5b3VyIGNoYW5nZXMgdG9cbi8vID8gYmUgcGVybWFuZW50KSwgY2FsbCBgbnBtIHJ1biByZWdlbmVyYXRlYCBhZnRlcndhcmRzXG5cbi8vICEgQmUgc3VyZSB0aGF0IHRhc2tzIGV4cGVjdGVkIHRvIHJ1biBvbiBucG0gaW5zdGFsbCAobWFya2VkIEBkZXBlbmRlbnQpIGhhdmVcbi8vICEgYWxsIHJlcXVpcmVkIHBhY2thZ2VzIGxpc3RlZCB1bmRlciBcImRlcGVuZGVuY2llc1wiIGluc3RlYWQgb2Zcbi8vICEgXCJkZXZEZXBlbmRlbmNpZXNcIiBpbiB0aGlzIHByb2plY3QncyBwYWNrYWdlLmpzb25cblxuLy8gVE9ETzogb24gYWxsIGJ1aWxkIHJ1biBjb21tYW5kcywgYnVtcCB0aGUgYnVpbGQgcGFja2FnZSB2ZXJzaW9uXG4vLyBUT0RPOiBhZGQgXCJ2ZXJzaW9uIGJ1bXBcIiBjb21tYW5kcyBmb3IgbWFqb3IsIG1pbm9yLCBwYXRjaCwgYW5kIGJ1aWxkIHZlcnNpb25zXG5cbmltcG9ydCB7IHJlYWRGaWxlIH0gZnJvbSAnZnMnXG5pbXBvcnQgeyBwcm9taXNpZnkgfSBmcm9tICd1dGlsJ1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCdcbmltcG9ydCB0YXAgZnJvbSAnZ3VscC10YXAnXG5pbXBvcnQgemlwIGZyb20gJ2d1bHAtemlwJ1xuaW1wb3J0IGRlbCBmcm9tICdkZWwnXG5pbXBvcnQgbG9nIGZyb20gJ2ZhbmN5LWxvZydcbmltcG9ydCBwYXJzZUdpdElnbm9yZSBmcm9tICdwYXJzZS1naXRpZ25vcmUnXG5pbXBvcnQgeyB0cmFuc2Zvcm1TeW5jIGFzIGJhYmVsIH0gZnJvbSAnQGJhYmVsL2NvcmUnXG5pbXBvcnQgeyByZWxhdGl2ZSBhcyByZWxQYXRoIH0gZnJvbSAncGF0aCdcbmltcG9ydCB3ZWJwYWNrIGZyb20gJ3dlYnBhY2snXG5pbXBvcnQgd2VicGFja0RldlNlcnZlciBmcm9tICd3ZWJwYWNrLWRldi1zZXJ2ZXInXG5pbXBvcnQgY29uZmlnIGZyb20gJy4vd2VicGFjay5jb25maWcnXG5pbXBvcnQgcGtnIGZyb20gJy4vcGFja2FnZSdcblxucmVxdWlyZSgnZG90ZW52JykuY29uZmlnKCk7XG5cbmNvbnN0IHtcbiAgICBXRUJQQUNLX1BPUlQsXG4gICAgREVWX0VORFBPSU5ULFxuICAgIEhBU0hJTkdfT1VUUFVUX0xFTkdUSFxufSA9IHByb2Nlc3MuZW52O1xuXG5jb25zdCBjb25maWd1cmVkID0gY29uZmlnKHsgTk9ERV9FTlY6IHByb2Nlc3MuZW52Lk5PREVfRU5WIH0pO1xuXG5pZih0eXBlb2YgV0VCUEFDS19QT1JUICE9PSAnc3RyaW5nJylcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdXRUJQQUNLX1BPUlQgaXMgaW1wcm9wZXJseSBkZWZpbmVkLiBEaWQgeW91IGNvcHkgZGlzdC5lbnYgLT4gLmVudiA/Jyk7XG5cbmlmKHR5cGVvZiBERVZfRU5EUE9JTlQgIT09ICdzdHJpbmcnKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0RFVl9FTkRQT0lOVCBpcyBpbXByb3Blcmx5IGRlZmluZWQuIERpZCB5b3UgY29weSBkaXN0LmVudiAtPiAuZW52ID8nKTtcblxuaWYodHlwZW9mIEhBU0hJTkdfT1VUUFVUX0xFTkdUSCAhPT0gJ3N0cmluZycpXG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSEFTSElOR19PVVRQVVRfTEVOR1RIIGlzIGltcHJvcGVybHkgZGVmaW5lZC4gRGlkIHlvdSBjb3B5IGRpc3QuZW52IC0+IC5lbnYgPycpO1xuXG5jb25zdCBERVZfUE9SVCA9IHBhcnNlSW50KFdFQlBBQ0tfUE9SVCwgMTApO1xuXG5jb25zdCBwYXRocyA9IHt9O1xuXG5wYXRocy5mbG93VHlwZWQgPSAnZmxvdy10eXBlZCc7XG5wYXRocy5mbG93VHlwZWRHaXRJZ25vcmUgPSBgJHtwYXRocy5mbG93VHlwZWR9Ly5naXRpZ25vcmVgO1xucGF0aHMuYnVpbGQgPSBgYnVpbGRgO1xucGF0aHMuYnVpbGRHaXRJZ25vcmUgPSBgJHtwYXRocy5idWlsZH0vLmdpdGlnbm9yZWA7XG5wYXRocy5jb25maWdzID0gJ2NvbmZpZyc7XG5wYXRocy5wYWNrYWdlSnNvbiA9ICdwYWNrYWdlLmpzb24nO1xucGF0aHMubGF1bmNoSnNvbiA9ICcudnNjb2RlL2xhdW5jaC5qc29uJztcbnBhdGhzLmxhdW5jaEpzb25EaXN0ID0gJy52c2NvZGUvbGF1bmNoLmRpc3QuanNvbic7XG5wYXRocy5lbnYgPSAnLmVudic7XG5wYXRocy5lbnZEaXN0ID0gJ2Rpc3QuZW52JztcbnBhdGhzLmdpdFByb2plY3REaXIgPSAnLmdpdCc7XG5wYXRocy5naXRJZ25vcmUgPSAnLmdpdGlnbm9yZSc7XG5wYXRocy5wYWNrYWdlTG9ja0pzb24gPSAncGFja2FnZS1sb2NrLmpzb24nO1xuXG5wYXRocy5yZWdlblRhcmdldHMgPSBbXG4gICAgYCR7cGF0aHMuY29uZmlnc30vKi5qc2Bcbl07XG5cbmNvbnN0IENMSV9CQU5ORVIgPSBgLyoqXG4qICEhISBETyBOT1QgRURJVCBUSElTIEZJTEUgRElSRUNUTFkgISEhXG4qICEgVGhpcyBmaWxlIGhhcyBiZWVuIGdlbmVyYXRlZCBhdXRvbWF0aWNhbGx5LiBTZWUgdGhlIGNvbmZpZy8qLmpzIHZlcnNpb24gb2ZcbiogISB0aGlzIGZpbGUgdG8gbWFrZSBwZXJtYW5lbnQgbW9kaWZpY2F0aW9ucyFcbiovXFxuXFxuYDtcblxuY29uc3QgcmVhZEZpbGVBc3luYyA9IHByb21pc2lmeShyZWFkRmlsZSk7XG5cbi8vICogQ0xFQU5UWVBFU1xuXG5leHBvcnQgY29uc3QgY2xlYW5UeXBlcyA9IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB0YXJnZXRzID0gcGFyc2VHaXRJZ25vcmUoYXdhaXQgcmVhZEZpbGVBc3luYyhwYXRocy5mbG93VHlwZWRHaXRJZ25vcmUpKTtcblxuICAgIGxvZyhgRGVsZXRpb24gdGFyZ2V0cyBAICR7cGF0aHMuZmxvd1R5cGVkfS86IFwiJHt0YXJnZXRzLmpvaW4oJ1wiIFwiJyl9XCJgKTtcbiAgICBkZWwodGFyZ2V0cywgeyBjd2Q6IHBhdGhzLmZsb3dUeXBlZCB9KTtcbn07XG5cbmNsZWFuVHlwZXMuZGVzY3JpcHRpb24gPSBgUmVzZXRzIHRoZSAke3BhdGhzLmZsb3dUeXBlZH0gZGlyZWN0b3J5IHRvIGEgcHJpc3RpbmUgc3RhdGVgO1xuXG4vLyAqIENMRUFOQlVJTERcblxuZXhwb3J0IGNvbnN0IGNsZWFuQnVpbGQgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0cyA9IHBhcnNlR2l0SWdub3JlKGF3YWl0IHJlYWRGaWxlQXN5bmMocGF0aHMuYnVpbGRHaXRJZ25vcmUpKTtcblxuICAgIGxvZyhgRGVsZXRpb24gdGFyZ2V0cyBAICR7cGF0aHMuYnVpbGR9LzogXCIke3RhcmdldHMuam9pbignXCIgXCInKX1cImApO1xuICAgIGRlbCh0YXJnZXRzLCB7IGN3ZDogcGF0aHMuYnVpbGQgfSk7XG59O1xuXG5jbGVhbkJ1aWxkLmRlc2NyaXB0aW9uID0gYFJlc2V0cyB0aGUgJHtwYXRocy5idWlsZH0gZGlyZWN0b3J5IHRvIGEgcHJpc3RpbmUgc3RhdGVgO1xuXG4vLyAqIFJFR0VORVJBVEVcblxuLy8gPyBJZiB5b3UgY2hhbmdlIHRoaXMgZnVuY3Rpb24sIHJ1biBgbnBtIHJ1biByZWdlbmVyYXRlYCB0d2ljZTogb25jZSB0b1xuLy8gPyBjb21waWxlIHRoaXMgbmV3IGZ1bmN0aW9uIGFuZCBvbmNlIGFnYWluIHRvIGNvbXBpbGUgaXRzZWxmIHdpdGggdGhlIG5ld2x5XG4vLyA/IGNvbXBpbGVkIGxvZ2ljLiBJZiB0aGVyZSBpcyBhbiBlcnJvciB0aGF0IHByZXZlbnRzIHJlZ2VuZXJhdGlvbiwgeW91IGNhblxuLy8gPyBydW4gYG5wbSBydW4gZ2VuZXJhdGVgIHRoZW4gYG5wbSBydW4gcmVnZW5lcmF0ZWAgaW5zdGVhZC5cbmV4cG9ydCBjb25zdCByZWdlbmVyYXRlID0gKCkgPT4ge1xuICAgIGxvZyhgUmVnZW5lcmF0aW5nIHRhcmdldHM6IFwiJHtwYXRocy5yZWdlblRhcmdldHMuam9pbignXCIgXCInKX1cImApO1xuXG4gICAgcHJvY2Vzcy5lbnYuQkFCRUxfRU5WID0gJ2dlbmVyYXRvcic7XG5cbiAgICByZXR1cm4gZ3VscC5zcmMocGF0aHMucmVnZW5UYXJnZXRzKVxuICAgICAgICAucGlwZSh0YXAoZmlsZSA9PiBmaWxlLmNvbnRlbnRzID0gQnVmZmVyLmZyb20oQ0xJX0JBTk5FUiArIGJhYmVsKGZpbGUuY29udGVudHMudG9TdHJpbmcoKSwge1xuICAgICAgICAgICAgc291cmNlRmlsZU5hbWU6IHJlbFBhdGgoX19kaXJuYW1lLCBmaWxlLnBhdGgpXG4gICAgICAgIH0pLmNvZGUpKSlcbiAgICAgICAgLnBpcGUoZ3VscC5kZXN0KCcuJykpO1xufTtcblxucmVnZW5lcmF0ZS5kZXNjcmlwdGlvbiA9ICdJbnZva2VzIGJhYmVsIG9uIHRoZSBmaWxlcyBpbiBjb25maWcsIHRyYW5zcGlsaW5nIHRoZW0gaW50byB0aGVpciBwcm9qZWN0IHJvb3QgdmVyc2lvbnMnO1xuXG4vLyAqIEJVSUxEIChwcm9kdWN0aW9uKVxuXG5leHBvcnQgY29uc3QgYnVpbGQgPSAoKTogUHJvbWlzZTx2b2lkPiA9PiB7XG4gICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAncHJvZHVjdGlvbic7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICB3ZWJwYWNrKGNvbmZpZ3VyZWQsIChlcnIsIHN0YXRzKSA9PiB7XG4gICAgICAgICAgICBpZihlcnIpXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGV0YWlscyA9IGVyci5kZXRhaWxzID8gYFxcblxcdCR7ZXJyLmRldGFpbHN9YCA6ICcnO1xuICAgICAgICAgICAgICAgIHRocm93IGBXRUJQQUNLIEZBVEFMIEJVSUxEIEVSUk9SOiAke2Vycn0ke2RldGFpbHN9YDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgY29uc3QgaW5mbyA9IHN0YXRzLnRvSnNvbigpO1xuXG4gICAgICAgICAgICBpZihzdGF0cy5oYXNFcnJvcnMoKSlcbiAgICAgICAgICAgICAgICB0aHJvdyBgV0VCUEFDSyBDT01QSUxBVElPTiBFUlJPUjogJHtpbmZvLmVycm9yc31gO1xuXG4gICAgICAgICAgICBpZihzdGF0cy5oYXNXYXJuaW5ncygpKVxuICAgICAgICAgICAgICAgIGNvbnNvbGUud2FybihgV0VCUEFDSyBDT01QSUxBVElPTiBXQVJOSU5HOiAke2luZm8ud2FybmluZ3N9YCk7XG5cbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59O1xuXG5idWlsZC5kZXNjcmlwdGlvbiA9ICdZaWVsZHMgYSBwcm9kdWN0aW9uLXJlYWR5IHVucGFja2VkIGV4dGVuc2lvbiB2aWEgdGhlIGJ1aWxkIGRpcmVjdG9yeSc7XG5cbi8vICogQlVORExFLVpJUFxuXG5leHBvcnQgY29uc3QgYnVuZGxlWmlwID0gKCkgPT4ge1xuICAgIHJldHVybiBndWxwLnNyYygnYnVpbGQvKicpLnBpcGUoemlwKGBkbnNjaGstJHtwa2cudmVyc2lvbn0uemlwYCkpLnBpcGUoZ3VscC5kZXN0KCcuJykpO1xufTtcblxuYnVuZGxlWmlwLmRlc2NyaXB0aW9uID0gJ0J1bmRsZXMgdGhlIGJ1aWxkIGRpcmVjdG9yeSBpbnRvIGEgemlwIGFyY2hpdmUgZm9yIHVwbG9hZCB0byB0aGUgQ2hyb21lIFdlYiBTdG9yZSBhbmQgZWxzZXdoZXJlJztcblxuLy8gKiBXUERFVlNFUlZcblxuZXhwb3J0IGNvbnN0IHdwZGV2c2VydiA9ICgpID0+IHtcbiAgICBPYmplY3Qua2V5cyhjb25maWd1cmVkLmVudHJ5KS5mb3JFYWNoKGVudHJ5S2V5ID0+IGNvbmZpZ3VyZWQuZW50cnlbZW50cnlLZXldID0gW1xuICAgICAgICBgd2VicGFjay1kZXYtc2VydmVyL2NsaWVudD9odHRwOi8vJHtERVZfRU5EUE9JTlR9OiR7REVWX1BPUlR9YCxcbiAgICAgICAgJ3dlYnBhY2svaG90L2Rldi1zZXJ2ZXInLFxuICAgICAgICBjb25maWd1cmVkLmVudHJ5W2VudHJ5S2V5XVxuICAgIF0pO1xuXG4gICAgY29uZmlndXJlZC5wbHVnaW5zID0gW1xuICAgICAgICBuZXcgd2VicGFjay5Ib3RNb2R1bGVSZXBsYWNlbWVudFBsdWdpbigpLFxuICAgICAgICAuLi4oY29uZmlndXJlZC5wbHVnaW5zID8/IFtdKSxcbiAgICBdO1xuXG4gICAgY29uc3QgcGFja2VyID0gd2VicGFjayhjb25maWd1cmVkKTtcbiAgICBjb25zdCBzZXJ2ZXIgPSBuZXcgd2VicGFja0RldlNlcnZlcihwYWNrZXIsIHtcbiAgICAgICAgaG90OiB0cnVlLFxuICAgICAgICBjb250ZW50QmFzZTogcGF0aHMuYnVpbGQsXG4gICAgICAgIGhlYWRlcnM6IHsgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU9yaWdpbic6ICcqJyB9XG4gICAgfSk7XG5cbiAgICBzZXJ2ZXIubGlzdGVuKERFVl9QT1JULCBlcnIgPT4geyBpZihlcnIpIHRocm93IGBXRUJQQUNLIERFViBTRVJWRVIgRVJST1I6ICR7ZXJyfWAgfSk7XG59O1xuXG53cGRldnNlcnYuZGVzY3JpcHRpb24gPSAnTGF1bmNoZXMgdGhlIFdlYnBhY2sgRGV2ZWxvcG1lbnQgU2VydmVyIGZvciB0ZXN0aW5nIHB1cnBvc2VzJztcbiJdfQ==