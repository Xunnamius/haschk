/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the config/*.js version of
* ! this file to make permanent modifications!
*/

"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.build = exports.wpdevserv = exports.cleanBuild = exports.cleanTypes = exports.regenerate = void 0;

require("source-map-support/register");

var _fs = require("fs");

var _util = require("util");

var _gulp = _interopRequireDefault(require("gulp"));

var _gulpTap = _interopRequireDefault(require("gulp-tap"));

var _del = _interopRequireDefault(require("del"));

var _fancyLog = _interopRequireDefault(require("fancy-log"));

var _parseGitignore = _interopRequireDefault(require("parse-gitignore"));

var _core = require("@babel/core");

var _path = require("path");

var _webpack = _interopRequireDefault(require("webpack"));

var _webpackDevServer = _interopRequireDefault(require("webpack-dev-server"));

var _webpack2 = _interopRequireDefault(require("./webpack.config"));

var _documentation = _interopRequireDefault(require("documentation"));

var _streamArray = _interopRequireDefault(require("stream-array"));

var _vinylFs = _interopRequireDefault(require("vinyl-fs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

require('dotenv').config();

const {
  WEBPACK_PORT,
  DEV_ENDPOINT
} = process.env;
if (typeof WEBPACK_PORT !== 'string') throw new TypeError('WEBPACK_PORT is improperly defined. Did you copy dist.env -> .env ?');
if (typeof DEV_ENDPOINT !== 'string') throw new TypeError('DEV_ENDPOINT is improperly defined. Did you copy dist.env -> .env ?');
const DEV_PORT = parseInt(WEBPACK_PORT, 10);
const paths = {};
paths.flowTyped = 'flow-typed';
paths.flowTypedGitIgnore = `${paths.flowTyped}/.gitignore`;
paths.build = `build`;
paths.buildGitIgnore = `${paths.build}/.gitignore`;
paths.configs = 'config';
paths.docs = 'docs/documentation';
paths.packageJson = 'package.json';
paths.launchJson = '.vscode/launch.json';
paths.launchJsonDist = '.vscode/launch.dist.json';
paths.env = '.env';
paths.envDist = 'dist.env';
paths.gitProjectDir = '.git';
paths.gitIgnore = '.gitignore';
paths.packageLockJson = 'package-lock.json';
paths.build = `${__dirname}/build`;
paths.regenTargets = [`${paths.configs}/*.js`];
const CLI_BANNER = `/**
* !!! DO NOT EDIT THIS FILE DIRECTLY !!!
* ! This file has been generated automatically. See the config/*.js version of
* ! this file to make permanent modifications!
*/\n\n`;

const generateDocs = () => {
  let entryPaths = Object.values(_webpack2.default.entry).slice().map(entry => {
    var _entry$slice$pop;

    return (_entry$slice$pop = entry.slice().pop()) !== null && _entry$slice$pop !== void 0 ? _entry$slice$pop : "";
  });
  return _documentation.default.build(entryPaths, {
    shallow: true
  }).then(_documentation.default.formats.html).then(output => {
    (0, _streamArray.default)(output).pipe(_vinylFs.default.dest(paths.docs));
  }).catch(function (err) {
    console.log(err);
  });
};

const readFileAsync = (0, _util.promisify)(_fs.readFile);

const cleanTypes = async () => {
  const targets = (0, _parseGitignore.default)((await readFileAsync(paths.flowTypedGitIgnore)));
  (0, _fancyLog.default)(`Deletion targets @ ${paths.flowTyped}/: "${targets.join('" "')}"`);
  (0, _del.default)(targets, {
    cwd: paths.flowTyped
  });
};

exports.cleanTypes = cleanTypes;
cleanTypes.description = `Resets the ${paths.flowTyped} directory to a pristine state`;

const cleanBuild = async () => {
  const targets = (0, _parseGitignore.default)((await readFileAsync(paths.buildGitIgnore)));
  (0, _fancyLog.default)(`Deletion targets @ ${paths.build}/: "${targets.join('" "')}"`);
  (0, _del.default)(targets, {
    cwd: paths.build
  });
};

exports.cleanBuild = cleanBuild;
cleanTypes.description = `Resets the ${paths.flowTyped} directory to a pristine state`;

const regenerate = () => {
  (0, _fancyLog.default)(`Regenerating targets: "${paths.regenTargets.join('" "')}"`);
  process.env.BABEL_ENV = 'generator';
  return _gulp.default.src(paths.regenTargets).pipe((0, _gulpTap.default)(file => file.contents = Buffer.from(CLI_BANNER + (0, _core.transformSync)(file.contents.toString(), {
    sourceFileName: (0, _path.relative)(__dirname, file.path)
  }).code))).pipe(_gulp.default.dest('.'));
};

exports.regenerate = regenerate;
regenerate.description = 'Invokes babel on the files in config, transpiling them into their project root versions';

const build = () => {
  process.env.NODE_ENV = 'production';
  return new Promise(resolve => {
    (0, _webpack.default)(_webpack2.default, (err, stats) => {
      if (err) {
        const details = err.details ? `\n\t${err.details}` : '';
        throw `WEBPACK FATAL BUILD ERROR: ${err}${details}`;
      }

      const info = stats.toJson();
      if (stats.hasErrors()) throw `WEBPACK COMPILATION ERROR: ${info.errors}`;
      if (stats.hasWarnings()) console.warn(`WEBPACK COMPILATION WARNING: ${info.warnings}`);
      resolve();
    });
  });
};

exports.build = build;
build.description = 'Yields a production-ready extension ready to be packaged';

const wpdevserv = () => {
  var _config$plugins;

  Object.keys(_webpack2.default.entry).forEach(entryKey => _webpack2.default.entry[entryKey] = [`webpack-dev-server/client?http://${DEV_ENDPOINT}:${DEV_PORT}`, 'webpack/hot/dev-server', _webpack2.default.entry[entryKey]]);
  _webpack2.default.plugins = [new _webpack.default.HotModuleReplacementPlugin(), ...((_config$plugins = _webpack2.default.plugins) !== null && _config$plugins !== void 0 ? _config$plugins : [])];
  const packer = (0, _webpack.default)(_webpack2.default);
  packer.hooks.afterCompile.tap('Generate Docs', () => {
    generateDocs();
  });
  const server = new _webpackDevServer.default(packer, {
    hot: true,
    contentBase: paths.build,
    headers: {
      'Access-Control-Allow-Origin': '*'
    }
  });
  server.listen(DEV_PORT, err => {
    if (err) throw `WEBPACK DEV SERVER ERROR: ${err}`;
  });
};

exports.wpdevserv = wpdevserv;
wpdevserv.description = 'Launches the Webpack Development Server for testing purposes';
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbmZpZy9ndWxwZmlsZS5qcyJdLCJuYW1lcyI6WyJyZXF1aXJlIiwiY29uZmlnIiwiV0VCUEFDS19QT1JUIiwiREVWX0VORFBPSU5UIiwicHJvY2VzcyIsImVudiIsIlR5cGVFcnJvciIsIkRFVl9QT1JUIiwicGFyc2VJbnQiLCJwYXRocyIsImZsb3dUeXBlZCIsImZsb3dUeXBlZEdpdElnbm9yZSIsImJ1aWxkIiwiYnVpbGRHaXRJZ25vcmUiLCJjb25maWdzIiwiZG9jcyIsInBhY2thZ2VKc29uIiwibGF1bmNoSnNvbiIsImxhdW5jaEpzb25EaXN0IiwiZW52RGlzdCIsImdpdFByb2plY3REaXIiLCJnaXRJZ25vcmUiLCJwYWNrYWdlTG9ja0pzb24iLCJfX2Rpcm5hbWUiLCJyZWdlblRhcmdldHMiLCJDTElfQkFOTkVSIiwiZ2VuZXJhdGVEb2NzIiwiZW50cnlQYXRocyIsIk9iamVjdCIsInZhbHVlcyIsImVudHJ5Iiwic2xpY2UiLCJtYXAiLCJwb3AiLCJkb2N1bWVudGF0aW9uIiwic2hhbGxvdyIsInRoZW4iLCJmb3JtYXRzIiwiaHRtbCIsIm91dHB1dCIsInBpcGUiLCJ2ZnMiLCJkZXN0IiwiY2F0Y2giLCJlcnIiLCJjb25zb2xlIiwibG9nIiwicmVhZEZpbGVBc3luYyIsInJlYWRGaWxlIiwiY2xlYW5UeXBlcyIsInRhcmdldHMiLCJqb2luIiwiY3dkIiwiZGVzY3JpcHRpb24iLCJjbGVhbkJ1aWxkIiwicmVnZW5lcmF0ZSIsIkJBQkVMX0VOViIsImd1bHAiLCJzcmMiLCJmaWxlIiwiY29udGVudHMiLCJCdWZmZXIiLCJmcm9tIiwidG9TdHJpbmciLCJzb3VyY2VGaWxlTmFtZSIsInBhdGgiLCJjb2RlIiwiTk9ERV9FTlYiLCJQcm9taXNlIiwicmVzb2x2ZSIsInN0YXRzIiwiZGV0YWlscyIsImluZm8iLCJ0b0pzb24iLCJoYXNFcnJvcnMiLCJlcnJvcnMiLCJoYXNXYXJuaW5ncyIsIndhcm4iLCJ3YXJuaW5ncyIsIndwZGV2c2VydiIsImtleXMiLCJmb3JFYWNoIiwiZW50cnlLZXkiLCJwbHVnaW5zIiwid2VicGFjayIsIkhvdE1vZHVsZVJlcGxhY2VtZW50UGx1Z2luIiwicGFja2VyIiwiaG9va3MiLCJhZnRlckNvbXBpbGUiLCJ0YXAiLCJzZXJ2ZXIiLCJ3ZWJwYWNrRGV2U2VydmVyIiwiaG90IiwiY29udGVudEJhc2UiLCJoZWFkZXJzIiwibGlzdGVuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFTQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBQSxPQUFPLENBQUMsUUFBRCxDQUFQLENBQWtCQyxNQUFsQjs7QUFFQSxNQUFNO0FBQUNDLEVBQUFBLFlBQUQ7QUFBZUMsRUFBQUE7QUFBZixJQUErQkMsT0FBTyxDQUFDQyxHQUE3QztBQUVBLElBQUcsT0FBT0gsWUFBUCxLQUF3QixRQUEzQixFQUNJLE1BQU0sSUFBSUksU0FBSixDQUFjLHFFQUFkLENBQU47QUFFSixJQUFHLE9BQU9ILFlBQVAsS0FBd0IsUUFBM0IsRUFDSSxNQUFNLElBQUlHLFNBQUosQ0FBYyxxRUFBZCxDQUFOO0FBRUosTUFBTUMsUUFBUSxHQUFHQyxRQUFRLENBQUNOLFlBQUQsRUFBZSxFQUFmLENBQXpCO0FBRUEsTUFBTU8sS0FBSyxHQUFHLEVBQWQ7QUFFQUEsS0FBSyxDQUFDQyxTQUFOLEdBQWtCLFlBQWxCO0FBQ0FELEtBQUssQ0FBQ0Usa0JBQU4sR0FBNEIsR0FBRUYsS0FBSyxDQUFDQyxTQUFVLGFBQTlDO0FBQ0FELEtBQUssQ0FBQ0csS0FBTixHQUFlLE9BQWY7QUFDQUgsS0FBSyxDQUFDSSxjQUFOLEdBQXdCLEdBQUVKLEtBQUssQ0FBQ0csS0FBTSxhQUF0QztBQUNBSCxLQUFLLENBQUNLLE9BQU4sR0FBZ0IsUUFBaEI7QUFDQUwsS0FBSyxDQUFDTSxJQUFOLEdBQWEsb0JBQWI7QUFDQU4sS0FBSyxDQUFDTyxXQUFOLEdBQW9CLGNBQXBCO0FBQ0FQLEtBQUssQ0FBQ1EsVUFBTixHQUFtQixxQkFBbkI7QUFDQVIsS0FBSyxDQUFDUyxjQUFOLEdBQXVCLDBCQUF2QjtBQUNBVCxLQUFLLENBQUNKLEdBQU4sR0FBWSxNQUFaO0FBQ0FJLEtBQUssQ0FBQ1UsT0FBTixHQUFnQixVQUFoQjtBQUNBVixLQUFLLENBQUNXLGFBQU4sR0FBc0IsTUFBdEI7QUFDQVgsS0FBSyxDQUFDWSxTQUFOLEdBQWtCLFlBQWxCO0FBQ0FaLEtBQUssQ0FBQ2EsZUFBTixHQUF3QixtQkFBeEI7QUFDQWIsS0FBSyxDQUFDRyxLQUFOLEdBQWUsR0FBRVcsU0FBVSxRQUEzQjtBQUVBZCxLQUFLLENBQUNlLFlBQU4sR0FBcUIsQ0FDaEIsR0FBRWYsS0FBSyxDQUFDSyxPQUFRLE9BREEsQ0FBckI7QUFLQSxNQUFNVyxVQUFVLEdBQUk7Ozs7T0FBcEI7O0FBT0EsTUFBTUMsWUFBWSxHQUFHLE1BQU07QUFFdkIsTUFBSUMsVUFBVSxHQUFHQyxNQUFNLENBQUNDLE1BQVAsQ0FBYzVCLGtCQUFPNkIsS0FBckIsRUFBNEJDLEtBQTVCLEdBQW9DQyxHQUFwQyxDQUF3Q0YsS0FBSyxJQUFJO0FBQUE7O0FBQUUsK0JBQVFBLEtBQUssQ0FBQ0MsS0FBTixHQUFjRSxHQUFkLEVBQVIsK0RBQStCLEVBQS9CO0FBQW1DLEdBQXRGLENBQWpCO0FBQ0EsU0FBT0MsdUJBQWN0QixLQUFkLENBQW9CZSxVQUFwQixFQUFnQztBQUFDUSxJQUFBQSxPQUFPLEVBQUU7QUFBVixHQUFoQyxFQUNGQyxJQURFLENBQ0dGLHVCQUFjRyxPQUFkLENBQXNCQyxJQUR6QixFQUVGRixJQUZFLENBRUdHLE1BQU0sSUFBSTtBQUNaLDhCQUFZQSxNQUFaLEVBQW9CQyxJQUFwQixDQUF5QkMsaUJBQUlDLElBQUosQ0FBU2pDLEtBQUssQ0FBQ00sSUFBZixDQUF6QjtBQUNILEdBSkUsRUFLRjRCLEtBTEUsQ0FLSSxVQUFTQyxHQUFULEVBQWM7QUFDakJDLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZRixHQUFaO0FBQ0gsR0FQRSxDQUFQO0FBUUgsQ0FYRDs7QUFhQSxNQUFNRyxhQUFhLEdBQUcscUJBQVVDLFlBQVYsQ0FBdEI7O0FBSUEsTUFBTUMsVUFBVSxHQUFHLFlBQVk7QUFDM0IsUUFBTUMsT0FBTyxHQUFHLDhCQUFlLE1BQU1ILGFBQWEsQ0FBQ3RDLEtBQUssQ0FBQ0Usa0JBQVAsQ0FBbEMsRUFBaEI7QUFFQSx5QkFBSyxzQkFBcUJGLEtBQUssQ0FBQ0MsU0FBVSxPQUFNd0MsT0FBTyxDQUFDQyxJQUFSLENBQWEsS0FBYixDQUFvQixHQUFwRTtBQUNBLG9CQUFJRCxPQUFKLEVBQWE7QUFBQ0UsSUFBQUEsR0FBRyxFQUFFM0MsS0FBSyxDQUFDQztBQUFaLEdBQWI7QUFDSCxDQUxEOzs7QUFPQXVDLFVBQVUsQ0FBQ0ksV0FBWCxHQUEwQixjQUFhNUMsS0FBSyxDQUFDQyxTQUFVLGdDQUF2RDs7QUFJQSxNQUFNNEMsVUFBVSxHQUFHLFlBQVk7QUFDM0IsUUFBTUosT0FBTyxHQUFHLDhCQUFlLE1BQU1ILGFBQWEsQ0FBQ3RDLEtBQUssQ0FBQ0ksY0FBUCxDQUFsQyxFQUFoQjtBQUVBLHlCQUFLLHNCQUFxQkosS0FBSyxDQUFDRyxLQUFNLE9BQU1zQyxPQUFPLENBQUNDLElBQVIsQ0FBYSxLQUFiLENBQW9CLEdBQWhFO0FBQ0Esb0JBQUlELE9BQUosRUFBYTtBQUFDRSxJQUFBQSxHQUFHLEVBQUUzQyxLQUFLLENBQUNHO0FBQVosR0FBYjtBQUNILENBTEQ7OztBQU9BcUMsVUFBVSxDQUFDSSxXQUFYLEdBQTBCLGNBQWE1QyxLQUFLLENBQUNDLFNBQVUsZ0NBQXZEOztBQVFBLE1BQU02QyxVQUFVLEdBQUcsTUFBTTtBQUNyQix5QkFBSywwQkFBeUI5QyxLQUFLLENBQUNlLFlBQU4sQ0FBbUIyQixJQUFuQixDQUF3QixLQUF4QixDQUErQixHQUE3RDtBQUVBL0MsRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVltRCxTQUFaLEdBQXdCLFdBQXhCO0FBRUEsU0FBT0MsY0FBS0MsR0FBTCxDQUFTakQsS0FBSyxDQUFDZSxZQUFmLEVBQ0ZnQixJQURFLENBQ0csc0JBQUltQixJQUFJLElBQUlBLElBQUksQ0FBQ0MsUUFBTCxHQUFnQkMsTUFBTSxDQUFDQyxJQUFQLENBQVlyQyxVQUFVLEdBQUcseUJBQU1rQyxJQUFJLENBQUNDLFFBQUwsQ0FBY0csUUFBZCxFQUFOLEVBQWdDO0FBQ3ZGQyxJQUFBQSxjQUFjLEVBQUUsb0JBQVF6QyxTQUFSLEVBQW1Cb0MsSUFBSSxDQUFDTSxJQUF4QjtBQUR1RSxHQUFoQyxFQUV4REMsSUFGK0IsQ0FBNUIsQ0FESCxFQUlGMUIsSUFKRSxDQUlHaUIsY0FBS2YsSUFBTCxDQUFVLEdBQVYsQ0FKSCxDQUFQO0FBS0gsQ0FWRDs7O0FBWUFhLFVBQVUsQ0FBQ0YsV0FBWCxHQUF5Qix5RkFBekI7O0FBSUEsTUFBTXpDLEtBQW9CLEdBQUcsTUFBTTtBQUMvQlIsRUFBQUEsT0FBTyxDQUFDQyxHQUFSLENBQVk4RCxRQUFaLEdBQXVCLFlBQXZCO0FBQ0EsU0FBTyxJQUFJQyxPQUFKLENBQVlDLE9BQU8sSUFBSTtBQUMxQiwwQkFBUXBFLGlCQUFSLEVBQWdCLENBQUMyQyxHQUFELEVBQU0wQixLQUFOLEtBQWdCO0FBQzVCLFVBQUcxQixHQUFILEVBQ0E7QUFDSSxjQUFNMkIsT0FBTyxHQUFHM0IsR0FBRyxDQUFDMkIsT0FBSixHQUFlLE9BQU0zQixHQUFHLENBQUMyQixPQUFRLEVBQWpDLEdBQXFDLEVBQXJEO0FBQ0EsY0FBTyw4QkFBNkIzQixHQUFJLEdBQUUyQixPQUFRLEVBQWxEO0FBQ0g7O0FBRUQsWUFBTUMsSUFBSSxHQUFHRixLQUFLLENBQUNHLE1BQU4sRUFBYjtBQUVBLFVBQUdILEtBQUssQ0FBQ0ksU0FBTixFQUFILEVBQ0ksTUFBTyw4QkFBNkJGLElBQUksQ0FBQ0csTUFBTyxFQUFoRDtBQUVKLFVBQUdMLEtBQUssQ0FBQ00sV0FBTixFQUFILEVBQ0kvQixPQUFPLENBQUNnQyxJQUFSLENBQWMsZ0NBQStCTCxJQUFJLENBQUNNLFFBQVMsRUFBM0Q7QUFFSlQsTUFBQUEsT0FBTztBQUNWLEtBaEJEO0FBaUJILEdBbEJNLENBQVA7QUFtQkgsQ0FyQkQ7OztBQXVCQXpELEtBQUssQ0FBQ3lDLFdBQU4sR0FBb0IsMERBQXBCOztBQUlBLE1BQU0wQixTQUFTLEdBQUcsTUFBTTtBQUFBOztBQUNwQm5ELEVBQUFBLE1BQU0sQ0FBQ29ELElBQVAsQ0FBWS9FLGtCQUFPNkIsS0FBbkIsRUFBMEJtRCxPQUExQixDQUFrQ0MsUUFBUSxJQUFJakYsa0JBQU82QixLQUFQLENBQWFvRCxRQUFiLElBQXlCLENBQ2xFLG9DQUFtQy9FLFlBQWEsSUFBR0ksUUFBUyxFQURNLEVBRW5FLHdCQUZtRSxFQUduRU4sa0JBQU82QixLQUFQLENBQWFvRCxRQUFiLENBSG1FLENBQXZFO0FBTUFqRixvQkFBT2tGLE9BQVAsR0FBaUIsQ0FDYixJQUFJQyxpQkFBUUMsMEJBQVosRUFEYSxFQUViLHVCQUFJcEYsa0JBQU9rRixPQUFYLDZEQUFzQixFQUF0QixDQUZhLENBQWpCO0FBS0EsUUFBTUcsTUFBTSxHQUFHLHNCQUFRckYsaUJBQVIsQ0FBZjtBQUVBcUYsRUFBQUEsTUFBTSxDQUFDQyxLQUFQLENBQWFDLFlBQWIsQ0FBMEJDLEdBQTFCLENBQThCLGVBQTlCLEVBQStDLE1BQU07QUFDakQvRCxJQUFBQSxZQUFZO0FBQ2YsR0FGRDtBQUlBLFFBQU1nRSxNQUFNLEdBQUcsSUFBSUMseUJBQUosQ0FBcUJMLE1BQXJCLEVBQTZCO0FBQ3hDTSxJQUFBQSxHQUFHLEVBQUUsSUFEbUM7QUFFeENDLElBQUFBLFdBQVcsRUFBRXBGLEtBQUssQ0FBQ0csS0FGcUI7QUFHeENrRixJQUFBQSxPQUFPLEVBQUU7QUFBQyxxQ0FBK0I7QUFBaEM7QUFIK0IsR0FBN0IsQ0FBZjtBQU1BSixFQUFBQSxNQUFNLENBQUNLLE1BQVAsQ0FBY3hGLFFBQWQsRUFBd0JxQyxHQUFHLElBQUk7QUFBRSxRQUFHQSxHQUFILEVBQVEsTUFBTyw2QkFBNEJBLEdBQUksRUFBdkM7QUFBMEMsR0FBbkY7QUFDSCxDQXpCRDs7O0FBMkJBbUMsU0FBUyxDQUFDMUIsV0FBVixHQUF3Qiw4REFBeEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBAZmxvdyAqL1xuXG4vLyA/IFRvIHJlZ2VuZXJhdGUgdGhpcyBmaWxlIChpLmUuIGlmIHlvdSBjaGFuZ2VkIGl0IGFuZCB3YW50IHlvdXIgY2hhbmdlcyB0b1xuLy8gPyBiZSBwZXJtYW5lbnQpLCBjYWxsIGBucG0gcnVuIHJlZ2VuZXJhdGVgIGFmdGVyd2FyZHNcblxuLy8gISBCZSBzdXJlIHRoYXQgdGFza3MgZXhwZWN0ZWQgdG8gcnVuIG9uIG5wbSBpbnN0YWxsIChtYXJrZWQgQGRlcGVuZGVudCkgaGF2ZVxuLy8gISBhbGwgcmVxdWlyZWQgcGFja2FnZXMgbGlzdGVkIHVuZGVyIFwiZGVwZW5kZW5jaWVzXCIgaW5zdGVhZCBvZlxuLy8gISBcImRldkRlcGVuZGVuY2llc1wiIGluIHRoaXMgcHJvamVjdCdzIHBhY2thZ2UuanNvblxuXG5pbXBvcnQge3JlYWRGaWxlfSBmcm9tICdmcydcbmltcG9ydCB7cHJvbWlzaWZ5fSBmcm9tICd1dGlsJ1xuaW1wb3J0IGd1bHAgZnJvbSAnZ3VscCdcbmltcG9ydCB0YXAgZnJvbSAnZ3VscC10YXAnXG5pbXBvcnQgZGVsIGZyb20gJ2RlbCdcbmltcG9ydCBsb2cgZnJvbSAnZmFuY3ktbG9nJ1xuaW1wb3J0IHBhcnNlR2l0SWdub3JlIGZyb20gJ3BhcnNlLWdpdGlnbm9yZSdcbmltcG9ydCB7dHJhbnNmb3JtU3luYyBhcyBiYWJlbH0gZnJvbSAnQGJhYmVsL2NvcmUnXG5pbXBvcnQge3JlbGF0aXZlIGFzIHJlbFBhdGh9IGZyb20gJ3BhdGgnXG5pbXBvcnQgd2VicGFjayBmcm9tICd3ZWJwYWNrJ1xuaW1wb3J0IHdlYnBhY2tEZXZTZXJ2ZXIgZnJvbSAnd2VicGFjay1kZXYtc2VydmVyJ1xuaW1wb3J0IGNvbmZpZyBmcm9tICcuL3dlYnBhY2suY29uZmlnJ1xuaW1wb3J0IGRvY3VtZW50YXRpb24gZnJvbSAnZG9jdW1lbnRhdGlvbidcbmltcG9ydCBzdHJlYW1BcnJheSBmcm9tICdzdHJlYW0tYXJyYXknXG5pbXBvcnQgdmZzIGZyb20gJ3ZpbnlsLWZzJ1xuXG5yZXF1aXJlKCdkb3RlbnYnKS5jb25maWcoKTtcblxuY29uc3Qge1dFQlBBQ0tfUE9SVCwgREVWX0VORFBPSU5UfSA9IHByb2Nlc3MuZW52O1xuXG5pZih0eXBlb2YgV0VCUEFDS19QT1JUICE9PSAnc3RyaW5nJylcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdXRUJQQUNLX1BPUlQgaXMgaW1wcm9wZXJseSBkZWZpbmVkLiBEaWQgeW91IGNvcHkgZGlzdC5lbnYgLT4gLmVudiA/Jyk7XG5cbmlmKHR5cGVvZiBERVZfRU5EUE9JTlQgIT09ICdzdHJpbmcnKVxuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0RFVl9FTkRQT0lOVCBpcyBpbXByb3Blcmx5IGRlZmluZWQuIERpZCB5b3UgY29weSBkaXN0LmVudiAtPiAuZW52ID8nKTtcblxuY29uc3QgREVWX1BPUlQgPSBwYXJzZUludChXRUJQQUNLX1BPUlQsIDEwKTtcblxuY29uc3QgcGF0aHMgPSB7fTtcblxucGF0aHMuZmxvd1R5cGVkID0gJ2Zsb3ctdHlwZWQnO1xucGF0aHMuZmxvd1R5cGVkR2l0SWdub3JlID0gYCR7cGF0aHMuZmxvd1R5cGVkfS8uZ2l0aWdub3JlYDtcbnBhdGhzLmJ1aWxkID0gYGJ1aWxkYDtcbnBhdGhzLmJ1aWxkR2l0SWdub3JlID0gYCR7cGF0aHMuYnVpbGR9Ly5naXRpZ25vcmVgO1xucGF0aHMuY29uZmlncyA9ICdjb25maWcnO1xucGF0aHMuZG9jcyA9ICdkb2NzL2RvY3VtZW50YXRpb24nO1xucGF0aHMucGFja2FnZUpzb24gPSAncGFja2FnZS5qc29uJztcbnBhdGhzLmxhdW5jaEpzb24gPSAnLnZzY29kZS9sYXVuY2guanNvbic7XG5wYXRocy5sYXVuY2hKc29uRGlzdCA9ICcudnNjb2RlL2xhdW5jaC5kaXN0Lmpzb24nO1xucGF0aHMuZW52ID0gJy5lbnYnO1xucGF0aHMuZW52RGlzdCA9ICdkaXN0LmVudic7XG5wYXRocy5naXRQcm9qZWN0RGlyID0gJy5naXQnO1xucGF0aHMuZ2l0SWdub3JlID0gJy5naXRpZ25vcmUnO1xucGF0aHMucGFja2FnZUxvY2tKc29uID0gJ3BhY2thZ2UtbG9jay5qc29uJztcbnBhdGhzLmJ1aWxkID0gYCR7X19kaXJuYW1lfS9idWlsZGA7XG5cbnBhdGhzLnJlZ2VuVGFyZ2V0cyA9IFtcbiAgICBgJHtwYXRocy5jb25maWdzfS8qLmpzYFxuXTtcblxuXG5jb25zdCBDTElfQkFOTkVSID0gYC8qKlxuKiAhISEgRE8gTk9UIEVESVQgVEhJUyBGSUxFIERJUkVDVExZICEhIVxuKiAhIFRoaXMgZmlsZSBoYXMgYmVlbiBnZW5lcmF0ZWQgYXV0b21hdGljYWxseS4gU2VlIHRoZSBjb25maWcvKi5qcyB2ZXJzaW9uIG9mXG4qICEgdGhpcyBmaWxlIHRvIG1ha2UgcGVybWFuZW50IG1vZGlmaWNhdGlvbnMhXG4qL1xcblxcbmA7XG5cbi8vIENvbnN0YW50IGluIGNhc2UgYXQgZGlmZmVyZW50IHBvaW50cyBpbiB0aGUgY29tcGlsYXRpb24gY3ljbGUgd2Ugd2FudCB0byByZWdlbmVyYXRlIHRoZSBkb2NzLiAoUkEpXG5jb25zdCBnZW5lcmF0ZURvY3MgPSAoKSA9PiB7XG4gICAgLy8gUmVtb3ZlcyBzcGVjaWFsIGVudHJ5IHBvaW50cyBmcm9tIFdlYlBhY2tcbiAgICBsZXQgZW50cnlQYXRocyA9IE9iamVjdC52YWx1ZXMoY29uZmlnLmVudHJ5KS5zbGljZSgpLm1hcChlbnRyeSA9PiB7IHJldHVybiAoZW50cnkuc2xpY2UoKS5wb3AoKSA/PyBcIlwiKX0pO1xuICAgIHJldHVybiBkb2N1bWVudGF0aW9uLmJ1aWxkKGVudHJ5UGF0aHMsIHtzaGFsbG93OiB0cnVlfSlcbiAgICAgICAgLnRoZW4oZG9jdW1lbnRhdGlvbi5mb3JtYXRzLmh0bWwpXG4gICAgICAgIC50aGVuKG91dHB1dCA9PiB7XG4gICAgICAgICAgICBzdHJlYW1BcnJheShvdXRwdXQpLnBpcGUodmZzLmRlc3QocGF0aHMuZG9jcykpO1xuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICB9KTtcbn07XG5cbmNvbnN0IHJlYWRGaWxlQXN5bmMgPSBwcm9taXNpZnkocmVhZEZpbGUpO1xuXG4vLyAqIENMRUFOVFlQRVNcblxuY29uc3QgY2xlYW5UeXBlcyA9IGFzeW5jICgpID0+IHtcbiAgICBjb25zdCB0YXJnZXRzID0gcGFyc2VHaXRJZ25vcmUoYXdhaXQgcmVhZEZpbGVBc3luYyhwYXRocy5mbG93VHlwZWRHaXRJZ25vcmUpKTtcblxuICAgIGxvZyhgRGVsZXRpb24gdGFyZ2V0cyBAICR7cGF0aHMuZmxvd1R5cGVkfS86IFwiJHt0YXJnZXRzLmpvaW4oJ1wiIFwiJyl9XCJgKTtcbiAgICBkZWwodGFyZ2V0cywge2N3ZDogcGF0aHMuZmxvd1R5cGVkfSk7XG59O1xuXG5jbGVhblR5cGVzLmRlc2NyaXB0aW9uID0gYFJlc2V0cyB0aGUgJHtwYXRocy5mbG93VHlwZWR9IGRpcmVjdG9yeSB0byBhIHByaXN0aW5lIHN0YXRlYDtcblxuLy8gKiBDTEVBTkJVSUxEXG5cbmNvbnN0IGNsZWFuQnVpbGQgPSBhc3luYyAoKSA9PiB7XG4gICAgY29uc3QgdGFyZ2V0cyA9IHBhcnNlR2l0SWdub3JlKGF3YWl0IHJlYWRGaWxlQXN5bmMocGF0aHMuYnVpbGRHaXRJZ25vcmUpKTtcblxuICAgIGxvZyhgRGVsZXRpb24gdGFyZ2V0cyBAICR7cGF0aHMuYnVpbGR9LzogXCIke3RhcmdldHMuam9pbignXCIgXCInKX1cImApO1xuICAgIGRlbCh0YXJnZXRzLCB7Y3dkOiBwYXRocy5idWlsZH0pO1xufTtcblxuY2xlYW5UeXBlcy5kZXNjcmlwdGlvbiA9IGBSZXNldHMgdGhlICR7cGF0aHMuZmxvd1R5cGVkfSBkaXJlY3RvcnkgdG8gYSBwcmlzdGluZSBzdGF0ZWA7XG5cbi8vICogUkVHRU5FUkFURVxuXG4vLyA/IElmIHlvdSBjaGFuZ2UgdGhpcyBmdW5jdGlvbiwgcnVuIGBucG0gcnVuIHJlZ2VuZXJhdGVgIHR3aWNlOiBvbmNlIHRvXG4vLyA/IGNvbXBpbGUgdGhpcyBuZXcgZnVuY3Rpb24gYW5kIG9uY2UgYWdhaW4gdG8gY29tcGlsZSBpdHNlbGYgd2l0aCB0aGUgbmV3bHlcbi8vID8gY29tcGlsZWQgbG9naWMuIElmIHRoZXJlIGlzIGFuIGVycm9yIHRoYXQgcHJldmVudHMgcmVnZW5lcmF0aW9uLCB5b3UgY2FuXG4vLyA/IHJ1biBgbnBtIHJ1biBnZW5lcmF0ZWAgdGhlbiBgbnBtIHJ1biByZWdlbmVyYXRlYCBpbnN0ZWFkLlxuY29uc3QgcmVnZW5lcmF0ZSA9ICgpID0+IHtcbiAgICBsb2coYFJlZ2VuZXJhdGluZyB0YXJnZXRzOiBcIiR7cGF0aHMucmVnZW5UYXJnZXRzLmpvaW4oJ1wiIFwiJyl9XCJgKTtcblxuICAgIHByb2Nlc3MuZW52LkJBQkVMX0VOViA9ICdnZW5lcmF0b3InO1xuXG4gICAgcmV0dXJuIGd1bHAuc3JjKHBhdGhzLnJlZ2VuVGFyZ2V0cylcbiAgICAgICAgLnBpcGUodGFwKGZpbGUgPT4gZmlsZS5jb250ZW50cyA9IEJ1ZmZlci5mcm9tKENMSV9CQU5ORVIgKyBiYWJlbChmaWxlLmNvbnRlbnRzLnRvU3RyaW5nKCksIHtcbiAgICAgICAgICAgIHNvdXJjZUZpbGVOYW1lOiByZWxQYXRoKF9fZGlybmFtZSwgZmlsZS5wYXRoKVxuICAgICAgICB9KS5jb2RlKSkpXG4gICAgICAgIC5waXBlKGd1bHAuZGVzdCgnLicpKTtcbn07XG5cbnJlZ2VuZXJhdGUuZGVzY3JpcHRpb24gPSAnSW52b2tlcyBiYWJlbCBvbiB0aGUgZmlsZXMgaW4gY29uZmlnLCB0cmFuc3BpbGluZyB0aGVtIGludG8gdGhlaXIgcHJvamVjdCByb290IHZlcnNpb25zJztcblxuLy8gKiBCVUlMRCAocHJvZHVjdGlvbilcblxuY29uc3QgYnVpbGQ6IFByb21pc2U8dm9pZD4gPSAoKSA9PiB7XG4gICAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAncHJvZHVjdGlvbic7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKHJlc29sdmUgPT4ge1xuICAgICAgICB3ZWJwYWNrKGNvbmZpZywgKGVyciwgc3RhdHMpID0+IHtcbiAgICAgICAgICAgIGlmKGVycilcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICBjb25zdCBkZXRhaWxzID0gZXJyLmRldGFpbHMgPyBgXFxuXFx0JHtlcnIuZGV0YWlsc31gIDogJyc7XG4gICAgICAgICAgICAgICAgdGhyb3cgYFdFQlBBQ0sgRkFUQUwgQlVJTEQgRVJST1I6ICR7ZXJyfSR7ZGV0YWlsc31gO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBjb25zdCBpbmZvID0gc3RhdHMudG9Kc29uKCk7XG5cbiAgICAgICAgICAgIGlmKHN0YXRzLmhhc0Vycm9ycygpKVxuICAgICAgICAgICAgICAgIHRocm93IGBXRUJQQUNLIENPTVBJTEFUSU9OIEVSUk9SOiAke2luZm8uZXJyb3JzfWA7XG5cbiAgICAgICAgICAgIGlmKHN0YXRzLmhhc1dhcm5pbmdzKCkpXG4gICAgICAgICAgICAgICAgY29uc29sZS53YXJuKGBXRUJQQUNLIENPTVBJTEFUSU9OIFdBUk5JTkc6ICR7aW5mby53YXJuaW5nc31gKVxuXG4gICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufTtcblxuYnVpbGQuZGVzY3JpcHRpb24gPSAnWWllbGRzIGEgcHJvZHVjdGlvbi1yZWFkeSBleHRlbnNpb24gcmVhZHkgdG8gYmUgcGFja2FnZWQnO1xuXG4vLyAqIFdQREVWU0VSVlxuXG5jb25zdCB3cGRldnNlcnYgPSAoKSA9PiB7XG4gICAgT2JqZWN0LmtleXMoY29uZmlnLmVudHJ5KS5mb3JFYWNoKGVudHJ5S2V5ID0+IGNvbmZpZy5lbnRyeVtlbnRyeUtleV0gPSBbXG4gICAgICAgIGB3ZWJwYWNrLWRldi1zZXJ2ZXIvY2xpZW50P2h0dHA6Ly8ke0RFVl9FTkRQT0lOVH06JHtERVZfUE9SVH1gLFxuICAgICAgICAnd2VicGFjay9ob3QvZGV2LXNlcnZlcicsXG4gICAgICAgIGNvbmZpZy5lbnRyeVtlbnRyeUtleV1cbiAgICBdKTtcblxuICAgIGNvbmZpZy5wbHVnaW5zID0gW1xuICAgICAgICBuZXcgd2VicGFjay5Ib3RNb2R1bGVSZXBsYWNlbWVudFBsdWdpbigpLFxuICAgICAgICAuLi4oY29uZmlnLnBsdWdpbnMgPz8gW10pLFxuICAgIF07XG5cbiAgICBjb25zdCBwYWNrZXIgPSB3ZWJwYWNrKGNvbmZpZyk7XG5cbiAgICBwYWNrZXIuaG9va3MuYWZ0ZXJDb21waWxlLnRhcCgnR2VuZXJhdGUgRG9jcycsICgpID0+IHtcbiAgICAgICAgZ2VuZXJhdGVEb2NzKCk7XG4gICAgfSk7XG5cbiAgICBjb25zdCBzZXJ2ZXIgPSBuZXcgd2VicGFja0RldlNlcnZlcihwYWNrZXIsIHtcbiAgICAgICAgaG90OiB0cnVlLFxuICAgICAgICBjb250ZW50QmFzZTogcGF0aHMuYnVpbGQsXG4gICAgICAgIGhlYWRlcnM6IHsnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJzogJyonfVxuICAgIH0pO1xuXG4gICAgc2VydmVyLmxpc3RlbihERVZfUE9SVCwgZXJyID0+IHsgaWYoZXJyKSB0aHJvdyBgV0VCUEFDSyBERVYgU0VSVkVSIEVSUk9SOiAke2Vycn1gIH0pO1xufTtcblxud3BkZXZzZXJ2LmRlc2NyaXB0aW9uID0gJ0xhdW5jaGVzIHRoZSBXZWJwYWNrIERldmVsb3BtZW50IFNlcnZlciBmb3IgdGVzdGluZyBwdXJwb3Nlcyc7XG5cbmV4cG9ydCB7cmVnZW5lcmF0ZSwgY2xlYW5UeXBlcywgY2xlYW5CdWlsZCwgd3BkZXZzZXJ2LCBidWlsZH07XG4iXX0=